<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Native American Language Archive</title>
    <style>
        /* BASE STYLES */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; 
            line-height: 1.6; 
            color: #222; 
            background: #fff; 
        }

        /* --- HEADER & BANNER (INCLUDES SEARCH BAR) --- */
        header { 
            background: #fff; 
            color: #222; 
            padding: 1.5rem 2rem 0.5rem; 
            /* Use Flexbox to align title/search bar on the same row */
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 1px solid #eee; 
            position: sticky; 
            top: 0;
            z-index: 1000;
        }
        .header-left {
            text-align: left;
        }
        header h1 { 
            font-size: 2rem; 
            margin-bottom: 0.25rem; 
        }
        header p { 
            font-size: 0.9rem; 
            font-style: normal; 
            color: #666; 
        }

        /* SEARCH BAR STYLES (NOW IN HEADER) */
        .search-wrapper { 
            max-width: 350px; /* Controls the width of the search box */
            width: 100%; 
            padding-top: 0.5rem; /* Align vertically with the header title */
        }
        .search-bar { width: 100%; position: relative; }
        .search-bar input { 
            width: 100%; 
            padding: 0.5rem 1rem; 
            font-size: 0.9rem; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            transition: all 0.3s; 
        }
        .search-bar input:focus { outline: none; border-color: #222; }
        .search-info { 
            text-align: right; 
            margin-top: 0.25rem; 
            font-size: 0.75rem; 
            color: #666; 
        }

        /* NAVIGATION */
        nav { 
            background: #fff; 
            border-bottom: 1px solid #eee; 
            padding: 0.25rem 0;
            position: sticky; 
            /* Position it right below the combined header/search area */
            top: 100px; 
            z-index: 999;
        }
        nav ul { list-style: none; display: flex; flex-wrap: wrap; justify-content: center; }
        nav a { 
            display: block; 
            padding: 0.75rem 1.25rem;
            color: #222; 
            text-decoration: none; 
            font-weight: 500; 
            transition: background 0.2s; 
            cursor: pointer; 
        }
        nav a:hover { background: #f5f5f5; border-radius: 0; }
        
        /* Dropdowns */
        .dropdown { position: relative; }
        .dropdown-content { 
            display: none; 
            position: absolute; 
            background: #fff; 
            min-width: 250px; 
            border: 1px solid #ddd; 
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
            z-index: 1000; 
            max-height: 300px; 
            overflow-y: auto; 
        }
        .dropdown:hover .dropdown-content, .dropdown-content.show { 
            display: block; 
        }

        .dropdown-content a { 
            padding: 0.75rem 1rem; 
            border-bottom: 1px solid #eee; 
            display: block; 
        }
        .dropdown-content a:last-child { border-bottom: none; }
        .dropdown-content a:hover { background: #f0f0f0; } 
        

        /* CONTENT SECTIONS */
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 2.5rem 2rem; 
        }
        section { 
            margin-bottom: 3rem; 
            padding: 0; 
            background: #fff; 
            border-bottom: 1px solid #eee;
            padding-bottom: 2rem;
        }
        .container section:last-of-type {
            border-bottom: none;
        }

        section h2 { 
            font-size: 1.8rem; 
            margin-bottom: 1rem; 
            padding-bottom: 0.5rem; 
            border-bottom: 1px solid #ddd; 
            color: #111;
        }
        .hidden { display: none; }

        /* --- STYLES FOR REGIONAL CARD DISPLAY (Region Grouping/Scrolling) --- */
        .resource-list {
            margin-top: 1.5rem;
        }
        .region-group {
            /* No top margin if regionFilter is applied */
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid #ddd;
        }
        .region-group h3 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            color: #444;
        }
        .region-scroll-container {
            max-height: 400px; 
            overflow-y: auto;
            padding-right: 15px; 
            padding-bottom: 5px;
        }
        .resource-card {
            background: #fcfcfc;
            border: 1px solid #eee;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .resource-card h4 {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
            color: #222;
        }
        .resource-details {
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: #777;
        }
        .resource-details span {
            display: inline-block;
            margin-right: 15px;
            font-weight: 500;
        }
        .resource-details a {
            color: #007bff;
            text-decoration: none;
        }
        
        /* --- Museum List Styles (for the separate museum section) --- */
        .museum-item {
            padding: 1rem 0;
            border-bottom: 1px dashed #ddd;
        }
        /* --- Story List (Padlet Style) --- */
        #storyList { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 1.5rem; 
            margin-top: 1.5rem; 
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                align-items: center;
                padding: 1rem;
            }
            .header-left {
                text-align: center;
                width: 100%;
            }
            .search-wrapper {
                max-width: 90%;
                padding-top: 1rem;
            }
            nav {
                top: 170px; /* Adjusted sticky position */
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <h1>Native American Language Archive</h1>
            <p>Linking Past, Present and Future Voices</p>
        </div>
        
        <div class="search-wrapper">
            <div class="search-bar">
                <input type="text" id="globalSearch" placeholder=" Search all resources by title, language, or region...">
            </div>
            <div class="search-info" id="searchInfo">Search across all resources</div>
        </div>
    </header>

    <nav>
        <ul>
            <li><a onclick="showSection('about')">About</a></li>
            <li class="dropdown">
                <a onclick="toggleDropdown(this)">Digital Archive</a>
                <div class="dropdown-content" id="digital-archive-menu"></div>
            </li>
            <li class="dropdown">
                <a onclick="toggleDropdown(this)">Books</a>
                <div class="dropdown-content" id="books-menu"></div>
            </li>
            <li class="dropdown">
                <a onclick="toggleDropdown(this)">Apps</a>
                <div class="dropdown-content" id="apps-menu"></div>
            </li>
            <li class="dropdown">
                <a onclick="showSection('museums-list')">Museums</a>
                <div class="dropdown-content" id="museums-menu"></div>
            </li>
            <li><a onclick="showSection('share')">Share a Story</a></li>
            <li><a onclick="showSection('contact')">Contact</a></li>
        </ul>
    </nav>

    <div class="container">
        <section id="about">
            <h2>About Our Mission</h2>
            <p>Indigenous languages carry the **wisdom, stories and cultural heritage** of communities that have stewarded this land for thousands of years. Yet many of these irreplaceable linguistic treasures face the threat of disappearing forever. Our platform serves as a digital sanctuary where **indigenous communities, linguists and language enthusiasts** can come together to preserve oral traditions and support vital revitalization work.</p>
            <p style="margin-top: 1rem;">Here, you'll find resources for learners, documentation projects led by native speakers and tools to help communities preserve their ancestral languages. We believe every language represents a unique way of understanding the world, and preserving linguistic diversity enriches us all. Whether you're reconnecting with your heritage language, supporting revitalization efforts or exploring how people communicate across cultures, this space honors the voices that have echoed across generations and ensures they continue to thrive.</p>
        </section>

        <section id="digital-archive-section" class="hidden">
            <h2 id="digital-archive-title">Digital Archives & Websites</h2>
            <p>A collection of online language learning platforms, digital archives, and educational websites categorized by region.</p>
            <div id="digital-archive-list" class="resource-list">
                </div>
        </section>

        <section id="books-section" class="hidden">
            <h2 id="books-title">Academic Books & Language Texts</h2>
            <p>Linguistic analyses, grammars, and rare academic texts for in-depth language study.</p>
            <div id="books-list" class="resource-list">
                </div>
        </section>

        <section id="apps-section" class="hidden">
            <h2 id="apps-title">Mobile Apps & Interactive Tools</h2>
            <p>Interactive mobile applications and software designed for language learning and immersion.</p>
            <div id="apps-list" class="resource-list">
                </div>
        </section>

        <section id="museums-list" class="hidden">
            <h2>Native American Museums & Cultural Centers</h2>
            <p>These institutions offer collections, archives, and cultural programming related to Native American languages and history.</p>
            <div id="museum-list-container" class="resource-list">
                </div>
        </section>
        <section id="share" class="hidden">
            <h2>Share a Story</h2>
            <p>Contribute your own story in English or in a Native American language. 
            These stories will become part of our growing archive and are saved in your browser.</p>
            <form id="storyForm">
                <input type="text" id="storyTitle" placeholder="Story Title" required>
                <input type="text" id="storyLanguage" placeholder="Language (e.g. English, Cherokee)" required>
                <textarea id="storyContent" placeholder="Write your story here..." rows="6" required></textarea>
                <input type="file" id="storyFile" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.mp3,.mp4,.wav">
                <label for="storyFile" style="font-size: 0.9rem; color: #666;">Optional: Attach a file (PDF, Word, Text, Image, or Audio)</label>
                <button type="submit">Submit Story</button>
            </form>
            
            <h2 style="margin-top: 3rem;">Community Stories</h2>
            <div id="storyList">
                <p style="padding: 1.5rem 0; grid-column: 1 / -1; text-align: center; color: #666;">No stories added yet. Be the first!</p>
            </div>
        </section>

        <section id="contact" class="hidden">
            <h2>Contact Us</h2>
            <p>Use the form below to send a message to our team. Your message will be drafted in your local email client.</p>
            <form id="contactForm" action="mailto:lefthand.textiles@gmail.com" method="post" enctype="text/plain">
                <input type="text" name="Name" placeholder="Your Name" required>
                <input type="email" name="Email" placeholder="Your Email" required>
                <textarea name="Message" placeholder="Your Message..." rows="6" required></textarea>
                <button type="submit">Send Message</button>
            </form>
        </section>
        
    </div>

    <footer>
        <p>&copy; 2025 Native American Language Archive | Honoring Indigenous Voices</p>
    </footer>

    <script>
        
        // --- RESOURCE DATA (Nested structure based on older file, populated with all 108 resources) ---
        const resources = {
            digitalArchive: {
                California: [
                    { title: "Native Languages of the Americas (California Section)", desc: "Small non-profit organization dedicated to Native American language survival through internet technology. Provides accessible vocabulary, cultural background, and pronunciation guides for hundreds of California languages.", identifier: "https://www.native-languages.org/california.htm", language: "California Languages", publisher: "Native Languages Org" },
                    { title: "California State Parks - Califomia Indians Language", desc: "Educational resource documenting Califomia's 12,000-year cultural heritage and sixty-four distinct indigenous languages.", identifier: "id 23548", language: "California Languages", publisher: "CA State Parks" },
                    { title: "College of the Redwoods - Local Languages Guide", desc: "Library guide supporting student understanding of northwestern California Indigenous languages including Tolowa, Karuk, Hupa, Yurok, Wiyot, Mattole, and Tsnungwe.", identifier: "https://redwoods.libguides.com/native-americans/iar", language: "Multiple CA Languages", publisher: "College of the Redwoods" },
                    { title: "Hathi Trust Digital Library", desc: "California Native Collections - Millions of digitized books online including rare materials on California Native languages. Full-view volumes are freely available.", identifier: "N/A", language: "California Languages", publisher: "HathiTrust" },
                    { title: "California Language Archive", desc: "Physical and digital archive for materials related to Indigenous languages of the Americas, including sound recordings from the Phoebe A. Hearst Museum of Anthropology.", identifier: "https://cia.berkeley.edu/", language: "130+ Indigenous Languages", publisher: "UC Berkeley" },
                    { title: "Survey of California and Other Indian Languages", desc: "Research center with 150+ linear feet covering ~130 languages, mainly western US, including 50+ California Indigenous languages", identifier: "https://linguistics.berkeley.edu/research/survey/", language: "50+ California Languages", publisher: "UC Berkeley" },
                    { title: "UC Berkeley Bancroft Library", desc: "Digital guide to collections relating to Indigenous communities in California.", identifier: "https://guides.lib.berkeley.edu/c.php?g=439975&p=3340048", language: "California Languages", publisher: "UC Berkeley" },
                    { title: "Yurok Language Project", desc: "Specialized digital archive focusing on Yurok language documentation from 2001-2024", identifier: "https://linguistics.berkeley.edu/~yurok/web/search.php", language: "Yurok", publisher: "UC Berkeley" },
                    { title: "UC Santa Barbara CEMA", desc: "California Ethnic and Multicultural Archives, includes J.P. Harrington Collection focusing on Chumash materials and language documentation", identifier: "https://www.library.ucsb.edu/special-collections/cema", language: "Chumash Languages", publisher: "UC Santa Barbara" }
                ],
                'Eastern Woodlands': [
                    { title: "Cherokee Nation Language Platform", desc: "Cherokee Nation's official online language learning platform offering free Cherokee language classes taught by Ed Fields.", identifier: "https://cnlearn.cherokee.org/", language: "Cherokee", publisher: "Cherokee Nation" },
                    { title: "Cherokee Learner Community Resources", desc: "Communitydriven educational resource collection accumulated by Cherokee language students.", identifier: "https://cherokeelearner.com/", language: "Cherokee", publisher: "Community-based" },
                    { title: "Eastern Band Cherokee Immersion Program", desc: "Eastern Band Cherokee immersion program offering online Cherokee lessons, dictionary database, and language preservation resources.", identifier: "https://newkituwah.com/", language: "Cherokee", publisher: "Eastern Band Cherokee" },
                    { title: "Ojibwe Language Learning Platform", desc: "Comprehensive Anishinaabemowin learning website providing beginner through advanced lessons, immersion support materials.", identifier: "https://ojibwe.net/", language: "Ojibwe", publisher: "Community-based" },
                    { title: "Learning Ojibwe Platform", desc: "Dedicated platform focused specifically on Ojibwe language instruction and cultural education.", identifier: "https://learningojibwe.com/", language: "Ojibwe", publisher: "Community-based" },
                    { title: "Western Carolina University Cherokee Collection", desc: "Academic research collection featuring Cherokee-language materials including children's books, textbooks, hymnals, biblical translations.", identifier: "https://www.wcu.edu/library/cherokee/index.aspx", language: "Cherokee", publisher: "Western Carolina University" },
                    { title: "Native American Language and Culture Preservation Project", desc: "New York State Library's 66-reel microfilm collection featuring books on Native American education, 17th-century Jesuit relations, religious works in Iroquoian and Algonquin languages.", identifier: "N/A", language: "Iroquoian and Algonquin Languages", publisher: "New York State Library" }
                ],
                'Great Basin': [
                    { title: "Northern Paiute Language Project", desc: "Comprehensive documentation project creating audio dictionary and text collections for community language learning.", identifier: "https://palute.ucsc.edu/", language: "Northern Paiute", publisher: "UC Santa Cruz" },
                    { title: "Shoshoni Language Project", desc: "Academic language preservation initiative housing Wick R. Miller Collection archive with irreplaceable texts, images, and audio recordings", identifier: "https://shoshoniproject.utah.edu/", language: "Shoshoni", publisher: "University of Utah" },
                    { title: "Shoshoni Talking Dictionary", desc: "Searchable online language resource supporting Newe Taikwa (Shoshoni) language use and encouraging new speakers.", identifier: "https://shoshoniproject.utah.edu/language-materials", language: "Shoshoni", publisher: "University of Utah" },
                    { title: "Pyramid Lake Paiute Tribe Language Department", desc: "Tribal language preservation program offering communitybased instruction and cultural education.", identifier: "https://plpt.nsn.us/language/", language: "Northern Paiute", publisher: "Pyramid Lake Paiute Tribe" },
                    { title: "Shoshone-Bannock Tribes Language & Cultural Pre", desc: "Tribal department providing instruction in both Shoshone and Bannock languages by tribal member instructors.", identifier: "https://www.sbtribes.com/language-culture/", language: "Shoshone, Bannock", publisher: "Shoshone-Bannock Tribes" },
                    { title: "California Language Archive - Northem Paiute Reso", desc: "Academic repository featuring linguistic documentation, grammatical analysis, and cultural materials for Northern Paiute language.", identifier: "https://cla.berkeley.edu/languages/northem-palute", language: "Northern Paiute", publisher: "UC Berkeley" },
                    { title: "Utah American Indian Digital Archive", desc: "Comprehensive digital repository featuring maps, documents, and cultural materials related to Western Shoshone, Northern Paiute, Southern Paiute, and Ute territories", identifier: "https://collections.lib.utah.edu/", language: "Numic Languages", publisher: "University of Utah" },
                    { title: "Great Basin Indian Archives", desc: "Collection of oral histories documenting life, heritage, and culture of native peoples in the Great Basin, housed at Great Basin College Virtual Humanities Center", identifier: "https://shoshoniproject.utah.edu/language-materials/great-basin-indian-archives/", language: "Great Basin Languages", publisher: "Great Basin College" }
                ],
                'Northwest Coast': [
                    { title: "Lingit Yoo X'atangi - The Tlingit Language", desc: "Comprehensive Tlingit language learning platform offering lessons, MOOC courses, dictionaries, and community resources.", identifier: "https://tlingitlanguage.com/", language: "Tlingit", publisher: "Community-based" },
                    { title: "Sealaska Heritage Institute Language Department", desc: "Official Southeast Alaska language revitalization hub for Lingit (Tlingit), Xaad Kil (Haida), and Sm'algyax (Tsimshian).", identifier: "https://sealaskaheritage.org/shi-language-departme", language: "Tlingit, Haida, Tsimshian", publisher: "Sealaska Heritage Institute" },
                    { title: "Haida Language Main Page", desc: "Dedicated website for Haida language study, preservation, and revitalization efforts.", identifier: "http://haidalanguage.org/", language: "Haida", publisher: "Community-based" },
                    { title: "Yukon Native Language Centre - Tlingit Resources", desc: "Academic center providing Interior Tlingit language materials including noun dictionaries, story books, language lessons, and audio resources.", identifier: "https://ynlc.ca/about-the-tlingit-language!", language: "Interior Tlingit", publisher: "Yukon Native Language Centre" },
                    { title: "University of Alaska Southeast - Xaad Kil Resources", desc: "Academic library guide featuring Haida language revitalization resources, historical linguistic studies.", identifier: "https://uas.alaska.libguides.com/c.php?g=14362888", language: "Haida", publisher: "University of Alaska Southeast" },
                    { title: "FirstVoices Archive", desc: "British Columbia-based digital archive providing community-controlled language documentation and preservation platform with multimedia collections", identifier: "https://www.firstvoices.com/", language: "Multiple NW Coast Languages", publisher: "First Peoples' Cultural Council" },
                    { title: "University of Alaska Digital Archives", desc: "Academic repositories preserving historical documents, audio recordings, and cultural materials related to Northwest Coast Indigenous peoples", identifier: "Contact university directly", language: "Northwest Coast Languages", publisher: "University of Alaska" }
                ],
                Plateau: [
                    { title: "FirstVoices - Northwest Coast Languages", desc: "Community-controlled digital platform featuring various Northwest Coast Indigenous languages including Halkomelem, Squamish, and other Salishan languages.", identifier: "https://www.firstvoices.com/", language: "Multiple Salishan Languages", publisher: "First Peoples' Cultural Council" },
                    { title: "Nez Perce Language Resources - OLAC", desc: "Online Language Archives Community repository providing access to Nez Perce (nimipuutimt) language materials.", identifier: "http://www.language-archives.org/language/nez", language: "Nez Perce", publisher: "OLAC" },
                    { title: "Yakama Nation Cultural Resources", desc: "Official tribal education program requiring two-year Sahaptin language instruction for students.", identifier: "https://www.yakama.org/academics/", language: "Sahaptin (Ichishklin)", publisher: "Yakama Nation" },
                    { title: "Secwepemc Language Department", desc: "Official language preservation program for Secwepemctsin (Shuswap) offering books, audio materials, and educational resources.", identifier: "Contact through Secwepemc First Nation", language: "Secwepemctsin (Shuswap)", publisher: "Secwepemc First Nation" },
                    { title: "Syilx Okanagan Nation nsyilxcən Language", desc: "Official Okanagan Nation Alliance language resource featuring nsyilxcən (Colville-Okanagan) materials and cultural information.", identifier: "https://svilx.org/about-us/svilx-nation/nsvilxen-langu", language: "nsyilxcən (Colville-Okanagan)", publisher: "Syilx Okanagan Nation" },
                    { title: "University of Oregon Northwest Indian Language In", desc: "Provides Sahaptin language classes and teacher training for Yakama and other Sahaptin languages. Academic support for language revitalization efforts.", identifier: "N/A", language: "Sahaptin Languages", publisher: "University of Oregon" },
                    { title: "Thompson Rivers University Salish Resources", desc: "Academic library guide featuring Interior Salish language materials including storytelling traditions, legends, songs, and oratory.", identifier: "https://libguides.tru.ca/indigenouslanguages/salish", language: "Interior Salish Languages", publisher: "Thompson Rivers Universi" }
                ],
                'Great Plains': [
                    { title: "Fort Belknap Language Preservation Program", desc: "A tribally-run program based in Harlem, Montana, serving the Fort Belknap Indian Reservation. Focuses on community-based preservation of Assiniboine and Gros Ventre languages.", identifier: "https://www.ftbelknaplanguagepreservation.com/", language: "Assiniboine, Gros Ventre", publisher: "Fort Belknap Tribes" },
                    { title: "Fort Peck Community College", desc: "Fort Peck Community College operates Native language immersion programs for Dakota and Nakota (Assiniboine) languages.", identifier: "https://www.fpcc.edu/", language: "Dakota, Nakota (Assiniboine)", publisher: "Fort Peck Community College" },
                    { title: "Indiana University - Fort Belknap Research", desc: "Academic research documenting oral traditions and language use at Fort Belknap Reservation and Carry The Kettle Reserve in Saskatchewan.", identifier: "https://indigenousknowledge.indiana.edu/research-a", language: "Assiniboine, Gros Ventre", publisher: "Indiana University" },
                    { title: "Native-Languages.org - Assiniboine", desc: "Online collection providing accessible Assiniboine vocabulary, pronunciation guides, and cultural background alongside hundreds of other Native languages.", identifier: "N/A", language: "Assiniboine", publisher: "Native Languages Org" },
                    { title: "Montana Digital Academy - Indigenous Language", desc: "Online high school courses launched 2023, serving grades 9-12 across Montana with academic credit.", identifier: "https://montanadigitalacademy.org/programs/indiger", language: "Multiple Montana Languages", publisher: "Montana Digital Academy" },
                    { title: "Aaniiih Nakoda College", desc: "Aaniiih Nakoda College on Fort Belknap Reservation is specifically charged with preserving and promoting both A'anin (Gros Ventre) and Nakoda (Assiniboine) languages.", identifier: "https://www.nakonauniversity.org/", language: "A'anin (Gros Ventre), Nakoda", publisher: "Aaniiih Nakoda College" }
                ],
                Nationwide: [
                    { title: "Native Languages of the Americas (Nationwide)", desc: "Small non-profit organization dedicated to Native American language survival through internet technology. The largest university archive of Indigenous language materials in North America", identifier: "https://www.native-languages.org/california.htm", language: "Multiple Languages", publisher: "Native Languages Org" },
                    { title: "DAILP", desc: "Community-based digital archive supporting indigenous peoples' knowledge and interpretations", identifier: "https://dailp.northeastern.edu/", language: "Multiple Languages", publisher: "Northeastern University" },
                    { title: "UC Merced Native Collections", desc: "Comprehensive guide to archives, libraries, and museums with Native American collections", identifier: "https://libguides.ucmerced.edu/native-american-indigenous/archives", language: "Multiple Languages", publisher: "UC Merced" },
                    { title: "John Carter Brown Library", desc: "Over 50,000 rare books, maps, and manuscripts on Indigenous History and Languages", identifier: "https://www.brown.edu/academics/libraries/john-carter-brown/", language: "Multiple Languages", publisher: "Brown University" }
                ]
            },
            books: {
                California: [
                    { title: "Surviving Through the Days", desc: "Anthology of treasures from oral literature of Native California, assembled by editor sensitive to language, culture, and history.", identifier: "N/A", language: "Multiple California Languages", publisher: "Various Publishers" },
                    { title: "Handbook of North American Indians, Volume 8 (Califomia)", desc: "Smithsonian Institution's scholarly reference series on Native American studies, with Volume 8 dedicated to California tribes.", identifier: "N/A", language: "California Languages", publisher: "Smithsonian Institution" },
                    { title: "Kumeyaay Library Department California Indian Books", desc: "Approved book list deemed culturally accurate by Kumeyaay panel for describing Southern California and northern Mexico Indigenous peoples", identifier: "N/A", language: "Kumeyaay and Southern California Languages", publisher: "Kumeyaay Library Department" },
                    { title: "Coast Miwok & Califomia Native American History Collection", desc: "Staff-curated collection focusing on Coast Miwok people, culture, and history.", identifier: "N/A", language: "Coast Miwok", publisher: "Marin Library" },
                    { title: "Indigenous & Native Culture Books", desc: "Collection celebrating Native people's resilience, perseverance, and strength, including specialized titles like 'Chumash Ethnobotany'.", identifier: "N/A", language: "Multiple California Languages", publisher: "ForestWatch Store" }
                ],
                'Eastern Woodlands': [
                    { title: "Cherokees Writing the Keetoowah Way Collection", desc: "Comprehensive translation collection including Dollie Duncan letters, Echota Funeral Notices, Willie Jumper Stories, government documents, speeches, and expanded historical materials", identifier: "N/A", language: "Cherokee", publisher: "Various Cherokee Communities" }
                ],
                'Great Basin': [
                    { title: "Southern Ute Cultural Center Publications", desc: "Community-created educational materials including language learning books, cultural guides, and traditional stories in Ute language.", identifier: "N/A", language: "Ute", publisher: "Southern Ute Cultural Center" },
                    { title: "University Linguistic Collections (Great Basin)", desc: "Academic publications from institutions like UC Berkeley, University of Utah, and other research centers providing grammatical analyses, dictionaries, and ethnolinguistic studies.", identifier: "N/A", language: "Great Basin Language Families", publisher: "Multiple Universities" },
                    { title: "Traditional Story Collections (Great Basin)", desc: "Compiled collections of traditional tales, oral histories, and cultural narratives preserved in original Great Basin languages.", identifier: "N/A", language: "Multiple Great Basin Languages", publisher: "Various Tribal Communities" }
                ],
                'Northwest Coast': [
                    { title: "Sealaska Heritage Institute Publications", desc: "Comprehensive collection of dictionaries, workbooks, and cultural materials for Tlingit, Haida, and Tsimshian languages.", identifier: "N/A", language: "Tlingit, Haida, Tsimshian", publisher: "Sealaska Heritage Institute" },
                    { title: "Tlingit Language Materials Collection", desc: "Extensive library of Beginning Tlingit workbooks by X'unei, Tlingit Dictionary drafts, Verb Dictionary by Constance Naish, and cultural materials.", identifier: "N/A", language: "Tlingit", publisher: "Various Tlingit Communities" }
                ],
                Plateau: [
                    { title: "Nez Perce Language Materials", desc: "Historical collection including ACLS materials by Livingston Farrand, Archie Phinney, Morris Swadesh, and tribal members. Features traditional stories, linguistic analyses.", identifier: "N/A", language: "Nez Perce", publisher: "Various Academic Institutions" },
                    { title: "Sahaptin Language Collections", desc: "Academic and community publications covering Yakama, Umatilla, Warm Springs dialects with grammatical analyses, vocabulary collections, and cultural materials.", identifier: "N/A", language: "Sahaptin (Yakama, Umatilla, Warm Springs)", publisher: "University of Oregon & Tribal Communities" },
                    { title: "Interior Salish Publications", desc: "Comprehensive collections including Secwepemctsin dictionaries, grammatical studies by A.H. Kuipers, and cultural materials for Shuswap, Thompson, Okanagan-Colville.", identifier: "N/A", language: "Interior Salishan Languages", publisher: "Academic & Tribal Institutions" },
                    { title: "Plateau Penutian Studies", desc: "Academic publications covering Klamath-Modoc language family with linguistic documentation, grammatical analyses, and comparative studies.", identifier: "N/A", language: "Klamath-Modoc", publisher: "University Presses" }
                ],
                'Great Plains': [
                    { title: "A Grammar of Nakoda (Assiniboine)", desc: "This is the first complete grammatical analysis of Assiniboine language. Provides comprehensive linguistic analysis including phonetics, morphology, and syntax.", identifier: "N/A", language: "Assiniboine (Nakoda)", publisher: "Linda A. Cumberland" },
                    { title: "A Concise Dictionary of Nakoda (Assiniboine)", desc: "A publication created with community member Wilma Kennedy. Offers the most current comprehensive dictionary for practical use by learners, teachers, and community members.", identifier: "N/A", language: "Assiniboine (Nakoda)", publisher: "Vincent Collette" },
                    { title: "Caddo Language Grammar and Materials", desc: "Published August 2018 Caddo grammar and in-depth 2004 examination of Caddo verb structure.", identifier: "N/A", language: "Caddo", publisher: "Academic Publishers" },
                    { title: "Pawnee Educational Materials", desc: "Alphabet book acting as quick reference guide for beginners and novice learners. Instructional materials available from Pawnee Nation Education Department.", identifier: "N/A", language: "Pawnee", publisher: "Pawnee Nation Education Department" },
                    { title: "Cheyenne and Arapaho Language Books and CDs", desc: "Educational materials produced by Cheyenne and Arapaho Tribes Language Program helping preserve and teach Arapaho language.", identifier: "N/A", language: "Cheyenne and Arapaho", publisher: "Cheyenne and Arapaho Tribes Language Program" }
                ],
                Southwest: [
                    { title: "Diné Bizaad: Speak, Read, Write Navajo", desc: "Comprehensive textbook providing structured approach to Navajo language learning with grammar instruction, vocabulary building, and cultural context.", identifier: "N/A", language: "Navajo (Diné bizaad)", publisher: "Various Publishers" },
                    { title: "Navajo Audio Programs (Audible)", desc: "Professional audio language learning programs available through Audible platform providing pronunciation guidance, conversational practice.", identifier: "N/A", language: "Navajo (Diné bizaad)", publisher: "Audible Platform" },
                    { title: "Academic Southwest Language Publications", desc: "University presses and academic institutions publish scholarly works covering Southwest Indigenous linguistics, including grammatical analyses of Tanoan, Keresan, and Yuman language families.", identifier: "N/A", language: "Tanoan, Keresan, Yuman Languages", publisher: "University Presses" },
                    { title: "Pueblo Language Educational Materials", desc: "Various pueblos have developed educational materials in their specific languages including children's books, cultural stories, and instructional resources.", identifier: "N/A", language: "Various Pueblo Languages", publisher: "Tribal Education Departments" },
                    { title: "Hopi Language Learning Resources", desc: "Books, audio recordings, and educational materials available for leaming Hopi language with cultural context.", identifier: "N/A", language: "Hopi", publisher: "Hopi Cultural Preservation Office" }
                ]
            },
            apps: {
                'Great Plains': [
                    { title: "100 Nakona Words - Fort Peck Series (Video/App)", desc: "This video presents 100 Nakona (Assiniboine) words and phrases combined with Plains Indian Sign Language from Fort Peck Reservation.", identifier: "https://www.youtube.com/watch?v=", language: "Nakona (Assiniboine)", publisher: "Fort Peck Community College" },
                    { title: "Stoney Nakoda Vocab Builder App", desc: "Free mobile app for Android/iOS focusing on Canadian Stoney dialect, closely related to American Assiniboine.", identifier: "App Stores", language: "Stoney Nakoda", publisher: "N/A" },
                    { title: "The Arapaho language app", desc: "The Arapaho language app was developed by fluent elders of the Northern Arapaho tribe in partnership with Arapahoe Schools from March 2015 to November 2016.", identifier: "Apple Store", language: "Arapaho", publisher: "Northern Arapaho Tribe / Arapahoe Schools" },
                    { title: "DeciphAR RLLC Blackfoot Translation App", desc: "Created by Mount Royal University Library and Red Crow Community College. Translates Blackfoot signage in the Riddell Library Learning Centre with augmented reality features.", identifier: "App Stores", language: "Blackfoot", publisher: "Mount Royal University Library / Red Crow Community College" },
                    { title: "Michif Lessons App", desc: "Available on mobile platforms. Contains over 60 exercises teaching 1000+ Michif words across 21 conversation topics.", identifier: "Mobile Platforms", language: "Michif", publisher: "N/A" }
                ],
                California: [
                    { title: "Yapi Kapi", desc: "UC Berkeley app making California Indian artifacts available online. Provides special tools for teachers and students, with classroom accounts, sub-accounts, assignment relay, and artifact collection viewing/commenting features.", identifier: "N/A", language: "California Languages", publisher: "UC Berkeley" },
                    { title: "Pomoan Languages Apps", desc: "Small selection of mobile applications for Pomoan language family from northem California. Part of The Language Conservancy's indigenous North American language app collection.", identifier: "App Stores", language: "Pomoan Languages", publisher: "The Language Conservancy" }
                ],
                'Eastern Woodlands': [
                    { title: "FirstVoices Mobile App", desc: "British Columbiabased platform offering keyboard and dictionary apps for 100+ Indigenous languages including Eastern Woodlands varieties.", identifier: "App Stores", language: "Multiple Languages", publisher: "FirstVoices" },
                    { title: "Ogoki Leaming App", desc: "Specialized developer with over 170 Indigenous language learning apps created over 10+ years. Partners directly with tribes and schools across Canada and United States.", identifier: "N/A", language: "Multiple Languages", publisher: "Ogoki Learning" },
                    { title: "FREELANG Dictionary App", desc: "Comprehensive multilingual dictionary platform available as Android app or online tool with reverse lookup functionality.", identifier: "Mobile Platforms", language: "Multiple Languages", publisher: "FREELANG" }
                ],
                'Great Basin': [
                    { title: "Newe Daygwap - Eastern Shoshone App", desc: "Fremont County School District #21's official Eastern Shoshone language learning application. Provides community-developed educational content.", identifier: "N/A", language: "Eastern Shoshone", publisher: "Fremont County School District #21" },
                    { title: "Northern Paiute Digital Resources (App)", desc: "The Northern Paiute Language Project has developed computer-based leaming materials and audio dictionaries, though specific mobile apps may be in development.", identifier: "N/A", language: "Northern Paiute", publisher: "UC Santa Cruz" },
                    { title: "Pyramid Lake Palute Tribe Digital Materials (App)", desc: "The tribe's language department provides digital resources and may offer mobile-accessible materials. Contact the tribal language program directly.", identifier: "N/A", language: "Northern Paiute", publisher: "Pyramid Lake Paiute Tribe" }
                ],
                'Northwest Coast': [
                    { title: "SHI Haida Language App (Xaad Kil)", desc: "Sealaska Heritage Institute's official Haida language learning application launched in 2023. Features audio pronunciation of words and phrases, video content.", identifier: "N/A", language: "Haida", publisher: "Sealaska Heritage Institute" },
                    { title: "SHI Tsimshian Language App (Sm'algyax)", desc: "Companion application to the Haida app, providing Tsimshian language instruction through audio, video, and interactive content.", identifier: "N/A", language: "Tsimshian", publisher: "Sealaska Heritage Institute" }
                ],
                Plateau: [
                    { title: "Nez Perce Tribe Digital Materials (App)", desc: "The Nez Perce Tribe's language department provides digital resources and may offer mobile-accessible learning materials.", identifier: "N/A", language: "Nez Perce", publisher: "Nez Perce Tribe" },
                    { title: "Yakama Nation Language App", desc: "The Yakama Nation Tribal School requires two years of Sahaptin language instruction and may have developed digital learning tools.", identifier: "N/A", language: "Sahaptin", publisher: "Yakama Nation" },
                    { title: "FirstVoices Mobile Platform (Plateau)", desc: "Various Plateau Indigenous languages are represented on FirstVoices mobile platform including Interior Salishan languages. Community-controlled digital platform.", identifier: "N/A", language: "Interior Salishan", publisher: "FirstVoices" }
                ],
                Southwest: [
                    { title: "Navajo M(A)L 4+ App", desc: "Learn Navajo Language (Diné bizaad) app uniquely designed to challenge abilities and help users learn at their own pace.", identifier: "N/A", language: "Navajo", publisher: "N/A" },
                    { title: "Lean Navajo Mobile Resources", desc: "Various mobile-optimized websites and resources are available for learning Diné bizaad, including vocabulary builders and pronunciation guides accessible through mobile browsers.", identifier: "N/A", language: "Navajo", publisher: "N/A" },
                    { title: "Pueblo Language Digital Tools (App)", desc: "Individual pueblos may have developed mobile-accessible resources for their specific languages. Contact tribal education departments directly.", identifier: "N/A", language: "Various Pueblo Languages", publisher: "Individual Pueblo Tribes" }
                ]
            },
            museums: {
                California: [
                    { title: "California Indian Museum and Cultural Center", desc: "Dedicated to educating the public about California Indian history, culture, and contemporary life from an Indian perspective", identifier: "Contact museum directly", language: "California Languages", publisher: "California Indian Museum" },
                    { title: "Marin Museum of the American Indian", desc: "Located on actual Miwok Village site in Novato, devoted to Native American culture with focus on local Miwok heritage", identifier: "Contact museum directly", language: "Miwok Languages", publisher: "Marin Museum" },
                    { title: "Malki Museum", desc: "Promotes scholarship and cultural awareness while encouraging preservation of Southern California Indian Cultures", identifier: "Contact museum directly", language: "Southern CA Languages", publisher: "Malki Museum" },
                    { title: "Barona Cultural Center & Museum", desc: "Offers outreach programs and educational content on Native American studies and local San Diego County history", identifier: "Contact museum directly", language: "San Diego County Languages", publisher: "Barona Cultural Center" }
                ],
                'Eastern Woodlands': [
                    { title: "Woodland Cultural Centre", desc: "Indigenous preservation museum dedicated to strengthening Indigenous language and culture", identifier: "https://woodlandculturalcentre.ca/", language: "Iroquoian Languages", publisher: "Woodland Cultural Centre" }
                ],
                'Great Basin': [
                    { title: "Stewart Indian School Cultural Center", desc: "Cultural center and museum preserving the heritage of the former Stewart Indian School with focus on Great Basin tribal cultures", identifier: "https://stewartindianschool.com/museum/", language: "Nevada Tribal Languages", publisher: "Stewart Indian School" }
                ],
                Plateau: [
                    { title: "Nez Perce National Historical Park Museum", desc: "Plateau cultural museum maintaining linguistic recordings, historical documents, and cultural materials for research and education", identifier: "Contact park directly", language: "Nez Perce", publisher: "Nez Perce National Park Service" },
                    { title: "Yakama Nation Cultural Center Museum", desc: "Plateau cultural museum maintaining linguistic recordings, historical documents, and cultural materials for research and education", identifier: "Contact center directly", language: "Sahaptin", publisher: "Yakama Nation" },
                    { title: "Secwepemc Museum", desc: "Plateau cultural museum maintaining linguistic recordings, historical documents, and cultural materials for research and education", identifier: "Contact museum directly", language: "Secwepemctsín", publisher: "Secwepemc Nation" }
                ],
                'Great Plains': [
                    { title: "Sam Noble Museum", desc: "Extensive Native American Languages Collection with 175+ languages represented through audio/video recordings, manuscripts, books, journals, and teaching curricula", identifier: "https://samnoblemuseum.ou.edu/collections-and-research/native-american-languages/", language: "175+ Native American Languages", publisher: "University of Oklahoma" }
                ],
                Southwest: [
                    { title: "Museum of Indian Arts and Culture", desc: "World-renowned museum centering Indigenous perspectives and voices of Pueblo, Navajo (Diné) and Apache cultures of the Southwest, featuring Native scholarship and oral histories", identifier: "https://www.newmexicoculture.org/museums/museum-of-indian-arts-culture", language: "Pueblo, Navajo, Apache Languages", publisher: "New Mexico Dept of Cultural Affairs" },
                    { title: "Heard Museum", desc: "Major museum with 12 galleries of American Indian art, over 40,000 items including library and archives with 34,000+ volumes, focus on Southwest Indigenous cultures", identifier: "https://heard.org/", language: "Southwest Languages", publisher: "Heard Museum" },
                    { title: "Indian Pueblo Cultural Center", desc: "Gateway to the 19 Pueblos with museum and exhibition galleries featuring Pueblo culture, murals by Pueblo artists, and cultural programs", identifier: "https://indianpueblo.org/", language: "Pueblo Languages", publisher: "Indian Pueblo Cultural Center" }
                ],
                Nationwide: [
                    { title: "Smithsonian NMAI", desc: "National Museum of the American Indian's educational initiative", identifier: "https://americanindian.si.edu/nk360", language: "Multiple Languages", publisher: "Smithsonian Institution" }
                ]
            }
        };

        // Helper map to connect link text to the data structure key
        const menuKeyMap = {
            'digital-archive-menu': { key: 'digitalArchive', title: 'Digital Archives & Websites' },
            'books-menu': { key: 'books', title: 'Academic Books & Language Texts' },
            'apps-menu': { key: 'apps', title: 'Mobile Apps & Interactive Tools' },
            'museums-menu': { key: 'museums', title: 'Native American Museums & Cultural Centers' }
        };

        let editingIndex = null; 
        
        // --- CORE RENDERING FUNCTIONS ---

        /** Renders a list of resources into regional, scrollable cards. */
        function renderRegionalCards(data, targetListId, regionFilter, isSearch = false) {
            const listContainer = document.getElementById(targetListId);
            listContainer.innerHTML = '';
            
            // If the data is empty or null, show a message
            if (!data || (Array.isArray(data) && data.length === 0) || (typeof data === 'object' && Object.keys(data).length === 0)) {
                listContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem 0;">No resources match your selection criteria.</p>';
                return;
            }

            // Normalize data to a set of regions/resources for rendering
            let resourcesByRegion;
            if (regionFilter) {
                // If a single region is filtered, data is an array
                resourcesByRegion = { [regionFilter]: data };
            } else if (isSearch) {
                // If it's a search, re-group the flattened array by region
                resourcesByRegion = data.reduce((acc, resource) => {
                    const region = resource.coverage || 'Unspecified Region';
                    if (!acc[region]) acc[region] = [];
                    acc[region].push(resource);
                    return acc;
                }, {});
            } else {
                // If rendering all (e.g., View All), data is the full regional object
                resourcesByRegion = data;
            }
            
            const sortedRegions = Object.keys(resourcesByRegion).sort();

            sortedRegions.forEach(region => {
                const regionData = resourcesByRegion[region];
                
                const regionGroup = document.createElement('div');
                regionGroup.className = 'region-group';
                
                // Only show region heading if we are showing multiple regions or explicitly for search results
                if (Object.keys(resourcesByRegion).length > 1 || isSearch) {
                     regionGroup.innerHTML = `<h3>Region: ${region}</h3>`;
                }

                const scrollContainer = document.createElement('div');
                scrollContainer.className = 'region-scroll-container';
                
                regionData.forEach(resource => {
                    const linkText = (resource.identifier && resource.identifier.startsWith('http')) ? 'View Resource' : (resource.identifier === 'N/A' || !resource.identifier ? 'N/A' : 'Details');
                    const linkHref = (resource.identifier && resource.identifier.startsWith('http')) ? resource.identifier : '#';
                    
                    const card = document.createElement('div');
                    card.className = 'resource-card';
                    card.innerHTML = `
                        <h4>${resource.title || resource.name}</h4>
                        <p>${resource.desc}</p>
                        <div class="resource-details">
                            <span><strong>Language:</strong> ${resource.language || 'N/A'}</span>
                            <span><strong>Publisher:</strong> ${resource.publisher || 'N/A'}</span>
                            <span><strong>Link:</strong> <a href="${linkHref}" target="_blank">${linkText}</a></span>
                        </div>
                    `;
                    scrollContainer.appendChild(card);
                });
                
                regionGroup.appendChild(scrollContainer);
                listContainer.appendChild(regionGroup);
            });
        }


        /** Filters resources by type and region, then renders the dedicated card section. */
        function renderTypeSection(typeKey, regionKey) {
            const config = {
                digitalArchive: { id: 'digital-archive-section', list: 'digital-archive-list', title: 'Digital Archives & Websites' },
                books: { id: 'books-section', list: 'books-list', title: 'Academic Books & Language Texts' },
                apps: { id: 'apps-section', list: 'apps-list', title: 'Mobile Apps & Interactive Tools' }
            };
            
            const currentConfig = config[typeKey];
            if (!currentConfig) return; 

            // Determine data to render
            let dataToRender;
            if (regionKey) {
                // Specific region selected (data is an array)
                dataToRender = resources[typeKey][regionKey] || [];
            } else {
                // "View All" selected (data is the whole object)
                dataToRender = resources[typeKey];
            }
            
            // Update section title 
            const titleElement = document.getElementById(currentConfig.id).querySelector('h2');
            const typeName = currentConfig.title.split(' ')[0];
            titleElement.textContent = regionKey ? `${regionKey} ${typeName} Resources` : currentConfig.title;

            showSection(currentConfig.id);
            // Pass the data and the region key (if one exists)
            renderRegionalCards(dataToRender, currentConfig.list, regionKey);
        }

        /** Renders the dedicated Museum list section. */
        function renderMuseums(regionKey) {
            const museumList = document.getElementById('museum-list-container');
            if (!museumList) return;
            
            museumList.innerHTML = '';
            
            const regionsData = resources.museums;
            let filteredMuseums = [];

            if (regionKey) {
                filteredMuseums = regionsData[regionKey] || [];
            } else {
                // Get all museums if 'View All' is clicked
                Object.values(regionsData).forEach(regionArray => {
                    filteredMuseums.push(...regionArray);
                });
            }

            if (filteredMuseums.length === 0) {
                museumList.innerHTML = '<p style="text-align: center; color: #666;">No museums found for this region.</p>';
                return;
            }

            filteredMuseums.forEach(museum => {
                const item = document.createElement('div');
                item.className = 'museum-item';
                const linkHref = (museum.identifier && museum.identifier.startsWith('http')) ? museum.identifier : '#';
                item.innerHTML = `
                    <h3><a href="${linkHref}" target="_blank">${museum.title || museum.name}</a></h3>
                    <p>${museum.desc}</p>
                    <p><strong>Coverage:</strong> ${regionKey || 'N/A'}</p>
                `;
                museumList.appendChild(item);
            });
            
            showSection('museums-list');
        }
        
        /** Builds navigation dropdown menus based on regions in the nested data. */
        function buildMenus() {
            const menuConfigs = [
                { id: 'digital-archive-menu', key: 'digitalArchive', typeName: 'Digital Archives' },
                { id: 'books-menu', key: 'books', typeName: 'Books' },
                { id: 'apps-menu', key: 'apps', typeName: 'Apps' },
                { id: 'museums-menu', key: 'museums', typeName: 'Museums' }
            ];

            menuConfigs.forEach(config => {
                const menu = document.getElementById(config.id);
                if (!menu) return;

                menu.innerHTML = ''; 
                const regions = Object.keys(resources[config.key]).sort();

                // 1. Add "View All" link
                const allLink = document.createElement('a');
                allLink.textContent = `View All ${config.typeName}`;
                
                if (config.key === 'museums') {
                    allLink.onclick = () => renderMuseums(null);
                } else {
                    allLink.onclick = () => renderTypeSection(config.key, null);
                }
                menu.appendChild(allLink);
                
                // Add divider
                if (regions.length > 0) {
                    const divider = document.createElement('div');
                    divider.style.borderTop = '1px solid #eee';
                    divider.style.margin = '0.5rem 0';
                    menu.appendChild(divider);
                }

                // 2. Add region links
                regions.forEach(region => {
                    const a = document.createElement('a');
                    a.textContent = region;
                    
                    if (config.key === 'museums') {
                        a.onclick = () => renderMuseums(region);
                    } else {
                        a.onclick = () => renderTypeSection(config.key, region);
                    }
                    menu.appendChild(a);
                });
            });
        }

        function showSection(sectionId) {
            // Hide all content sections (excluding the fixed search bar)
            document.querySelectorAll('.container section').forEach(section => {
                section.classList.add('hidden');
            });

            // Show the requested section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Close all dropdowns
            document.querySelectorAll('.dropdown-content').forEach(content => {
                content.classList.remove('show');
            });
        }

        function toggleDropdown(element) {
            const dropdownContent = element.nextElementSibling;
            
            // Close other open dropdowns
            document.querySelectorAll('.dropdown-content').forEach(content => {
                if (content !== dropdownContent) {
                    content.classList.remove('show');
                }
            });
            
            dropdownContent.classList.toggle('show');
        }

        // --- GLOBAL SEARCH FUNCTION ---
        function flattenResourcesForSearch() {
            const flatList = [];
            const typesToSearch = ['digitalArchive', 'books', 'apps'];
            
            typesToSearch.forEach(typeKey => {
                const regions = resources[typeKey];
                for (const region in regions) {
                    regions[region].forEach(resource => {
                        // Attach the coverage/region for filtering later
                        flatList.push({ ...resource, coverage: region, type: typeKey });
                    });
                }
            });
            return flatList;
        }

        // --- STORY/LOCAL STORAGE FUNCTIONS (Placeholder) ---
        function renderStories() {
            const storyList = document.getElementById('storyList');
            if (!storyList) return;
            const stories = JSON.parse(localStorage.getItem('stories') || '[]');
            storyList.innerHTML = '';
            
            if (stories.length === 0) {
                storyList.innerHTML = '<p style="padding: 1.5rem 0; grid-column: 1 / -1; text-align: center; color: #666;">No stories added yet. Be the first!</p>';
                return;
            }
            // Simplified rendering for brevity
            stories.forEach((story, index) => {
                const storyDiv = document.createElement('div');
                storyDiv.className = 'story';
                storyDiv.innerHTML = `
                    <button class="delete-btn" onclick="deleteStory(${index})">Delete</button>
                    <h3>${story.title}</h3>
                    <p>${story.content.substring(0, 100)}...</p>`;
                storyList.appendChild(storyDiv);
            });
        }

        function deleteStory(index) { /* ... delete logic ... */ }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            buildMenus(); 
            
            // Initialize rendering of main sections 
            renderTypeSection('digitalArchive', null);
            renderTypeSection('books', null);
            renderTypeSection('apps', null);
            renderMuseums(null); 
            
            renderStories(); 
            showSection('about'); // Default to showing the 'About' section on load
            
            // Global Search Listener
            document.getElementById('globalSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const flattenedData = flattenResourcesForSearch();

                const filtered = flattenedData.filter(resource => 
                    (resource.title && resource.title.toLowerCase().includes(searchTerm)) ||
                    (resource.desc && resource.desc.toLowerCase().includes(searchTerm)) ||
                    (resource.language && resource.language.toLowerCase().includes(searchTerm)) ||
                    (resource.coverage && resource.coverage.toLowerCase().includes(searchTerm)) ||
                    (resource.publisher && resource.publisher.toLowerCase().includes(searchTerm))
                );
                
                if (searchTerm.length > 0) {
                    document.getElementById('digital-archive-title').textContent = `Search Results for "${this.value}"`;
                    showSection('digital-archive-section');
                    // Pass the filtered array and set isSearch=true to trigger combined regional grouping in renderRegionalCards
                    renderRegionalCards(filtered, 'digital-archive-list', null, true); 
                } else {
                    document.getElementById('digital-archive-title').textContent = `Digital Archives & Websites`;
                    showSection('about');
                    // Reset the Digital Archive content to 'View All' when search is cleared
                    renderTypeSection('digitalArchive', null);
                }
            });
        });
    </script>
</body>
</html>
