<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Native American Language Archive</title>
    <style>
        /* BASE STYLES */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        /* Pure white background for the entire page */
        body { 
            /* Font is set to Helvetica family as requested */
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; 
            line-height: 1.6; 
            color: #222; 
            background: #fff; 
        }

        /* HEADER & BANNER (SIMPLE LIGHT THEME) */
        header { 
            background: #fff; 
            color: #222; 
            padding: 1.5rem 1rem 0.5rem; 
            text-align: center; 
            /* Subtle border at the bottom of the header */
            border-bottom: 1px solid #eee; 
            position: sticky; /* Sticky header */
            top: 0;
            z-index: 1000;
        }
        header h1 { font-size: 2rem; margin-bottom: 0.25rem; }
        header p { font-size: 0.9rem; font-style: normal; color: #666; }

        /* NAVIGATION (FLAT, HIGH-CONTRAST) */
        nav { 
            background: #fff; 
            /* Subtle border below the navigation */
            border-bottom: 1px solid #eee; 
            padding: 0.25rem 0;
            position: sticky; /* Make nav sticky as well */
            top: 68px; /* Position it right below the header (approx height of header) */
            z-index: 999;
        }
        nav ul { list-style: none; display: flex; flex-wrap: wrap; justify-content: center; }
        nav a { 
            display: block; 
            padding: 0.75rem 1.25rem;
            color: #222; 
            text-decoration: none; 
            font-weight: 500; 
            transition: background 0.2s; 
            cursor: pointer; /* Ensure link areas are clearly clickable */
        }
        nav a:hover { background: #f5f5f5; border-radius: 0; }
        
        /* Dropdowns */
        .dropdown { position: relative; }
        .dropdown-content { 
            display: none; 
            position: absolute; 
            background: #fff; 
            min-width: 200px; 
            border: 1px solid #ddd; 
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
            z-index: 1000; 
        }
        /* FIXED: Use .show class to force display on click */
        .dropdown:hover .dropdown-content, .dropdown-content.show { 
            display: block; 
        }

        .dropdown-content a { 
            padding: 0.75rem 1rem; 
            /* Subtle lines within the dropdown */
            border-bottom: 1px solid #eee; 
            display: block; 
        }
        .dropdown-content a:last-child { border-bottom: none; }
        .dropdown-content a:hover { background: #f0f0f0; } 
        

        /* SEARCH BAR (MADE STICKY) */
        .search-container { 
            background: #fff; 
            padding: 1rem 1.5rem; 
            /* Subtle border at the bottom of the search bar */
            border-bottom: 1px solid #ddd; 
            position: sticky; 
            /* Adjusted position to stick properly below the header and nav */
            top: 115px; 
            z-index: 998;
            box-shadow: none; 
        }
        .search-wrapper { max-width: 1200px; margin: 0 auto; }
        .search-bar { width: 100%; max-width: 800px; margin: 0 auto; position: relative; }
        .search-bar input { 
            width: 100%; 
            padding: 0.75rem 1.5rem; 
            font-size: 1rem; 
            border: 1px solid #ccc; /* Simple, light border */
            border-radius: 4px; 
            transition: all 0.3s; 
        }
        .search-bar input:focus { outline: none; border-color: #222; }
        .search-info { text-align: center; margin-top: 0.5rem; font-size: 0.8rem; color: #666; }

        /* CONTENT SECTIONS */
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 2.5rem 2rem; 
        }
        section { 
            margin-bottom: 3rem; 
            padding: 0; 
            background: #fff; 
            border: none; 
            border-radius: 0; 
            box-shadow: none; 
            /* Add a very subtle line below sections (except the last one in the container) */
            border-bottom: 1px solid #eee;
            padding-bottom: 2rem;
        }
        .container section:last-of-type {
            border-bottom: none;
        }

        section h2 { 
            font-size: 1.8rem; 
            margin-bottom: 1rem; 
            padding-bottom: 0.5rem; 
            /* The subtitle line remains a bit stronger for emphasis */
            border-bottom: 1px solid #ddd; 
            color: #111;
        }
        .hidden { display: none; }

        /* --- NEW STYLES FOR RESOURCE DATA AND MUSEUMS --- */
        /* Table Styles for Resources Section (Addresses missing fields) */
        .resource-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            font-size: 0.9rem;
            table-layout: fixed; /* Ensures column widths are respected */
        }
        .resource-table th, .resource-table td {
            padding: 0.75rem 0.5rem;
            border: 1px solid #eee;
            text-align: left;
            vertical-align: top;
        }
        .resource-table th {
            background: #f8f8f8;
            font-weight: 600;
            color: #444;
            position: sticky;
            top: 159px; /* Sticks below header/nav/search (115px + ~44px search height) */
            z-index: 997;
        }
        .resource-table a {
            word-wrap: break-word;
        }

        /* Museum List Styles (Addresses museum heading and content) */
        .museum-item {
            padding: 1rem 0;
            border-bottom: 1px dashed #ddd;
        }
        .museum-item:last-child {
            border-bottom: none;
        }
        .museum-item h3 {
            margin-bottom: 0.25rem;
            font-size: 1.2rem;
            color: #222;
        }
        .museum-item a {
            color: #007bff;
            text-decoration: none;
        }
        .museum-item a:hover {
            text-decoration: underline;
        }

        /* --- Story List (Padlet Style) --- */
        #storyList { 
            /* This grid layout creates the Padlet-style card arrangement */
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 1.5rem; 
            margin-top: 1.5rem; 
        }
        .story { 
            background: #fcfcfc; 
            padding: 1rem; 
            border: 1px solid #ddd; 
            border-radius: 6px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            position: relative;
            min-height: 150px;
        }
        .story h3 { font-size: 1.2rem; margin-bottom: 0.5rem; }
        .story em { display: block; font-size: 0.85rem; color: #777; margin-bottom: 0.75rem; }
        .story p { font-size: 0.95rem; margin-top: 0; }
        .file-attachment { font-size: 0.8rem; margin-top: 1rem; padding-top: 0.5rem; border-top: 1px solid #eee; }
        .file-attachment a { color: #007bff; text-decoration: none; }

        /* Action Buttons */
        .delete-btn, .edit-btn {
            position: absolute;
            top: 8px;
            padding: 4px 8px;
            font-size: 0.7rem;
            cursor: pointer;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 3px;
            line-height: 1;
            transition: background 0.2s;
            z-index: 10;
        }
        .delete-btn { right: 8px; color: #dc3545; border-color: #dc3545; }
        .delete-btn:hover { background: #dc3545; color: #fff; }
        .edit-btn { right: 50px; color: #007bff; border-color: #007bff; }
        .edit-btn:hover { background: #007bff; color: #fff; }


        /* FORMS & BUTTONS */
        form { margin-top: 1.5rem; display: flex; flex-direction: column; gap: 0.75rem; }
        form input, form textarea { 
            padding: 0.6rem; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            font-size: 1rem; 
            background: #fff;
        }
        form button { 
            background: #222; 
            color: #fff; 
            border: none; 
            padding: 0.75rem 1.5rem; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: 600; 
            align-self: flex-start;
            transition: background 0.2s;
        }
        form button:hover { background: #444; }

        /* FOOTER */
        footer { 
            background: #f8f8f8; 
            color: #555; 
            text-align: center; 
            padding: 1.5rem 1rem; 
            margin-top: 3rem; 
            /* Subtle border above the footer */
            border-top: 1px solid #eee; 
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 768px) {
            nav ul { flex-direction: column; }
            nav a { padding: 0.75rem; }
            .search-container { top: 120px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Native American Language Archive</h1>
        <p>Linking Past, Present and Future Voices</p>
    </header>

    <nav>
        <ul>
            <li><a onclick="showSection('about')">About</a></li>
            <li class="dropdown">
                <a onclick="toggleDropdown(this)">Digital Archive</a>
                <div class="dropdown-content" id="digital-archive-menu"></div>
            </li>
            <li class="dropdown">
                <a onclick="toggleDropdown(this)">Books</a>
                <div class="dropdown-content" id="books-menu"></div>
            </li>
            <li class="dropdown">
                <a onclick="toggleDropdown(this)">Apps</a>
                <div class="dropdown-content" id="apps-menu"></div>
            </li>
            <li class="dropdown">
                <a onclick="toggleDropdown(this)">Museums</a>
                <div class="dropdown-content" id="museums-menu"></div>
            </li>
            <li><a onclick="showSection('share')">Share a Story</a></li>
            <li><a onclick="showSection('contact')">Contact</a></li>
        </ul>
    </nav>

    <div class="search-container">
        <div class="search-wrapper">
            <div class="search-bar">
                <input type="text" id="globalSearch" placeholder=" Search all resources by title, description, language, publisher, or region...">
            </div>
            <div class="search-info" id="searchInfo">Search across all resources</div>
        </div>
    </div>

    <div class="container">
        <section id="about">
            <h2>About Our Mission</h2>
            <p>Indigenous languages carry the **wisdom, stories and cultural heritage** of communities that have stewarded this land for thousands of years. Yet many of these irreplaceable linguistic treasures face the threat of disappearing forever. Our platform serves as a digital sanctuary where **indigenous communities, linguists and language enthusiasts** can come together to preserve oral traditions and support vital revitalization work.</p>
            <p style="margin-top: 1rem;">Here, you'll find resources for learners, documentation projects led by native speakers and tools to help communities preserve their ancestral languages. We believe every language represents a unique way of understanding the world, and preserving linguistic diversity enriches us all. Whether you're reconnecting with your heritage language, supporting revitalization efforts or exploring how people communicate across cultures, this space honors the voices that have echoed across generations and ensures they continue to thrive.</p>
        </section>

        <section id="resources" class="hidden">
            <h2 id="resource-title">Complete Resource Database</h2>
            <p>Below is the complete list of resources. Use the search bar or navigation filters above to narrow your results.</p>
            <div id="resource-list" class="resource-list">
                <table class="resource-table">
                    <thead>
                        <tr>
                            <th style="width: 15%;">Title</th>
                            <th style="width: 8%;">Type</th>
                            <th style="width: 35%;">Description</th>
                            <th style="width: 12%;">Identifier (Link)</th>
                            <th style="width: 8%;">Coverage (Region)</th>
                            <th style="width: 12%;">Language</th>
                            <th style="width: 10%;">Publisher</th>
                        </tr>
                    </thead>
                    <tbody id="resource-table-body">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="share" class="hidden">
            <h2>Share a Story</h2>
            <p>Contribute your own story in English or in a Native American language. 
            These stories will become part of our growing archive and are saved in your browser.</p>
            <form id="storyForm">
                <input type="text" id="storyTitle" placeholder="Story Title" required>
                <input type="text" id="storyLanguage" placeholder="Language (e.g. English, Cherokee)" required>
                <textarea id="storyContent" placeholder="Write your story here..." rows="6" required></textarea>
                <input type="file" id="storyFile" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.mp3,.mp4,.wav">
                <label for="storyFile" style="font-size: 0.9rem; color: #666;">Optional: Attach a file (PDF, Word, Text, Image, or Audio)</label>
                <button type="submit">Submit Story</button>
            </form>
            
            <h2 style="margin-top: 3rem;">Community Stories</h2>
            <div id="storyList">
                <p style="padding: 1.5rem 0; grid-column: 1 / -1; text-align: center; color: #666;">No stories added yet. Be the first!</p>
            </div>
        </section>

        <section id="contact" class="hidden">
            <h2>Contact Us</h2>
            <p>Use the form below to send a message to our team. Your message will be drafted in your local email client.</p>
            <form id="contactForm" action="mailto:lefthand.textiles@gmail.com" method="post" enctype="text/plain">
                <input type="text" name="Name" placeholder="Your Name" required>
                <input type="email" name="Email" placeholder="Your Email" required>
                <textarea name="Message" placeholder="Your Message..." rows="6" required></textarea>
                <button type="submit">Send Message</button>
            </form>
        </section>
        
    </div>

    <footer>
        <p>&copy; 2025 Native American Language Archive | Honoring Indigenous Voices</p>
    </footer>

    <script>
        // --- RESOURCE DATA (Combined resources and museums into a single list) ---
        // Resource Types for filtering: "Website", "Digital Archive", "Academic Book", "App", "Museum"
        const allResources = [
            // Websites & Digital Archives (simulated from PDF)
            { title: "Native Languages of the Americas (California Section)", type: "Website", desc: "Small non-profit organization dedicated to Native American language survival...", identifier: "https://www.native-languages.org/california.htm", coverage: "California", language: "California Languages", publisher: "Native Languages Org" },
            { title: "Cherokee Nation Language Platform", type: "App", desc: "Cherokee Nation's official online language learning platform offering free Cherokee language classes...", identifier: "https://cnlearn.cherokee.org/", coverage: "Eastern Woodlands", language: "Cherokee", publisher: "Cherokee Nation" },
            { title: "Shoshoni Language Project", type: "Digital Archive", desc: "Academic language preservation initiative housing Wick R. Miller Collection archive...", identifier: "https://shoshoniproject.utah.edu/", coverage: "Great Basin", language: "Shoshoni", publisher: "University of Utah" },
            { title: "Lingit Yoo X'atangi - The Tlingit Language", type: "Website", desc: "Comprehensive Tlingit language learning platform offering lessons, dictionaries, and community resources", identifier: "https://tlingitlanguage.com/", coverage: "Northwest Coast", language: "Tlingit", publisher: "Community-based" },
            { title: "Hathi Trust Digital Library", type: "Digital Archive", desc: "California Native Collections - Millions of digitized books online including rare materials...", identifier: "N/A", coverage: "California", language: "California Languages", publisher: "HathiTrust" },
            { title: "A Grammar of Nakoda (Assiniboine)", type: "Academic Book", desc: "The first complete grammatical analysis of Assiniboine language.", identifier: "N/A", coverage: "Great Plains", language: "Assiniboine (Nakoda)", publisher: "Linda A. Cumberland" },
            { title: "Salish Language Kit", type: "App", desc: "Interactive mobile application for learning Salish language basics.", identifier: "AppStore/GooglePlay", coverage: "Plateau", language: "Salish", publisher: "Salish Culture Center" },
            
            // Museums (simulated from PDF, classified as "Museum" type)
            { title: "Sam Noble Museum", type: "Museum", desc: "Extensive Native American Languages Collection with 175+ languages represented...", identifier: "https://samnoblemuseum.ou.edu/", coverage: "Great Plains", language: "175+ Languages", publisher: "University of Oklahoma" },
            { title: "Museum of Indian Arts and Culture", type: "Museum", desc: "World-renowned museum centering Indigenous perspectives and voices of Pueblo, Navajo (DinÃ©) and Apache cultures...", identifier: "https://www.newmexicoculture.org/", coverage: "Southwest", language: "Pueblo, Navajo, Apache", publisher: "New Mexico Dept of Cultural Affairs" },
            { title: "Heard Museum", type: "Museum", desc: "Major museum with 12 galleries of American Indian art, over 40,000 items...", identifier: "https://heard.org/", coverage: "Southwest", language: "Southwest Languages", publisher: "Heard Museum" },
            { title: "Indian Pueblo Cultural Center", type: "Museum", desc: "Gateway to the 19 Pueblos with museum and exhibition galleries featuring Pueblo culture...", identifier: "https://indianpueblo.org/", coverage: "Southwest", language: "Pueblo Languages", publisher: "Indian Pueblo Cultural Center" },
        ];

        let editingIndex = null; 
        
        // --- UTILITY FUNCTIONS ---

        /** Extracts unique regions from the dataset. */
        function getUniqueRegions(type) {
            const uniqueRegions = new Set();
            allResources.forEach(resource => {
                if (type === 'Museums' && resource.type === 'Museum' && resource.coverage) {
                    uniqueRegions.add(resource.coverage);
                } else if (resource.type === type && resource.coverage) {
                    uniqueRegions.add(resource.coverage);
                }
            });
            // Alphabetize the regions
            return Array.from(uniqueRegions).sort();
        }

        /** Filters resources based on type and region, then renders the table. */
        function filterAndShowResources(typeFilter, regionFilter) {
            const filteredResources = allResources.filter(resource => {
                // Determine resource type based on nav section
                let matchesType;
                if (typeFilter === 'Digital Archive') {
                    matchesType = (resource.type === 'Digital Archive' || resource.type === 'Website');
                } else if (typeFilter === 'Books') {
                    matchesType = (resource.type === 'Academic Book');
                } else if (typeFilter === 'Apps') {
                    matchesType = (resource.type === 'App');
                } else if (typeFilter === 'Museums') {
                    matchesType = (resource.type === 'Museum');
                } else {
                    matchesType = true; // Show all if no type filter (e.g., initial search page)
                }

                const matchesRegion = (regionFilter === null || resource.coverage === regionFilter);
                
                return matchesType && matchesRegion;
            });

            // Update title and show section
            const titleElement = document.getElementById('resource-title');
            let titleText = "Complete Resource Database";
            
            if (regionFilter) {
                titleText = `${regionFilter} ${typeFilter} Resources`;
            } else if (typeFilter) {
                titleText = `${typeFilter} Resources`;
            }
            titleElement.textContent = titleText;

            showSection('resources');
            renderResources(filteredResources);
        }

        /** Populates the resource table with data. */
        function renderResources(data) {
            const tableBody = document.getElementById('resource-table-body');
            if (!tableBody) return;

            tableBody.innerHTML = ''; 

            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No resources match your selection criteria.</td></tr>';
                return;
            }

            data.forEach(resource => {
                const row = document.createElement('tr');
                // Ensure link works if identifier is not 'N/A'
                const linkDisplay = resource.identifier === 'N/A' ? 'N/A' : 'Link';
                const linkHref = resource.identifier === 'N/A' ? '#' : resource.identifier;
                
                row.innerHTML = `
                    <td><strong>${resource.title}</strong></td>
                    <td>${resource.type}</td>
                    <td>${resource.desc}</td>
                    <td><a href="${linkHref}" target="_blank">${linkDisplay}</a></td>
                    <td>${resource.coverage || 'N/A'}</td>
                    <td>${resource.language || 'N/A'}</td>
                    <td>${resource.publisher || 'N/A'}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        /** Builds navigation dropdown menus based on regions and types. */
        function buildMenus() {
            const menuConfigs = [
                { id: 'digital-archive-menu', type: 'Digital Archive' },
                { id: 'books-menu', type: 'Academic Book' },
                { id: 'apps-menu', type: 'App' },
                { id: 'museums-menu', type: 'Museums' } // 'Museums' is a special case for type filtering
            ];

            menuConfigs.forEach(config => {
                const menu = document.getElementById(config.id);
                if (!menu) return;

                menu.innerHTML = ''; // Clear previous content

                // Add an option to view all of that resource type
                const allLink = document.createElement('a');
                allLink.textContent = `View All ${config.type.replace('Academic Book', 'Books').replace('Museums', 'Museums')}`;
                allLink.onclick = () => filterAndShowResources(config.type, null);
                menu.appendChild(allLink);
                
                // Add a divider
                const divider = document.createElement('div');
                divider.style.borderTop = '1px solid #eee';
                divider.style.margin = '0.5rem 0';
                menu.appendChild(divider);


                // Add region filters
                const regions = getUniqueRegions(config.type === 'Museums' ? 'Museum' : config.type);
                regions.forEach(region => {
                    const a = document.createElement('a');
                    a.textContent = region;
                    a.onclick = () => filterAndShowResources(config.type, region);
                    menu.appendChild(a);
                });
            });
        }

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.container section').forEach(section => {
                section.classList.add('hidden');
            });

            // Show the requested section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Close all dropdowns
            document.querySelectorAll('.dropdown-content').forEach(content => {
                content.classList.remove('show');
            });
        }

        function toggleDropdown(element) {
            const dropdownContent = element.nextElementSibling;
            
            // Close other open dropdowns
            document.querySelectorAll('.dropdown-content').forEach(content => {
                if (content !== dropdownContent) {
                    content.classList.remove('show');
                }
            });
            
            dropdownContent.classList.toggle('show');
        }

        // --- STORY FUNCTIONALITY (Share, Edit, Delete, Persistence) ---
        
        function renderStories() {
            const storyList = document.getElementById('storyList');
            if (!storyList) return;
            // Retrieve stories from browser's local storage
            const stories = JSON.parse(localStorage.getItem('stories') || '[]');
            storyList.innerHTML = '';
            
            if (stories.length === 0) {
                storyList.innerHTML = '<p style="padding: 1.5rem 0; grid-column: 1 / -1; text-align: center; color: #666;">No stories added yet. Be the first!</p>';
                return;
            }

            stories.forEach((story, index) => {
                const storyDiv = document.createElement('div');
                storyDiv.className = 'story';
                storyDiv.setAttribute('data-index', index);
                
                let fileAttachmentHtml = '';
                if (story.fileName && story.fileData) {
                    fileAttachmentHtml = `
                        <div class="file-attachment">
                            <strong>Attachment:</strong> <a href="${story.fileData}" download="${story.fileName}">${story.fileName}</a>
                        </div>
                    `;
                }
                
                // Padlet-style card with Edit/Delete buttons
                storyDiv.innerHTML = `
                    <button class="delete-btn" onclick="deleteStory(${index})">Delete</button>
                    <button class="edit-btn" onclick="editStory(${index})">Edit</button>
                    <h3>${story.title}</h3>
                    <em>Language: ${story.language}</em>
                    <p>${story.content.replace(/\n/g, '<br>')}</p>
                    ${fileAttachmentHtml}
                `;
                storyList.appendChild(storyDiv);
            });
        }

        function deleteStory(index) {
            if (confirm("Are you sure you want to delete this story? This action cannot be undone.")) {
                const stories = JSON.parse(localStorage.getItem('stories') || '[]');
                stories.splice(index, 1);
                localStorage.setItem('stories', JSON.stringify(stories));
                renderStories();
            }
        }

        function editStory(index) {
            const stories = JSON.parse(localStorage.getItem('stories') || '[]');
            const story = stories[index];
            if (!story) return;

            // Populate form with current story data
            document.getElementById('storyTitle').value = story.title;
            document.getElementById('storyLanguage').value = story.language;
            document.getElementById('storyContent').value = story.content;
            
            // Set editing state and update button text
            editingIndex = index;
            document.getElementById('storyForm').querySelector('button[type="submit"]').textContent = 'Update Story';

            // Scroll to the form for easy editing
            document.getElementById('share').scrollIntoView({ behavior: 'smooth' });
        }


        document.getElementById('storyForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const storyTitle = document.getElementById('storyTitle').value;
            const storyLanguage = document.getElementById('storyLanguage').value;
            const storyContent = document.getElementById('storyContent').value;
            const fileInput = document.getElementById('storyFile');

            const newStory = {
                title: storyTitle,
                language: storyLanguage,
                content: storyContent,
                fileName: null,
                fileData: null 
            };
            
            const saveStory = (story) => {
                let stories = JSON.parse(localStorage.getItem('stories') || '[]');
                if (editingIndex !== null) {
                    // Update existing story
                    stories[parseInt(editingIndex)] = story;
                } else {
                    // Add new story
                    stories.push(story);
                }
                
                // Save back to local storage
                localStorage.setItem('stories', JSON.stringify(stories));
                
                // Reset form state
                editingIndex = null; 
                document.getElementById('storyForm').querySelector('button[type="submit"]').textContent = 'Submit Story';
                this.reset();
                renderStories();
            };

            // Handle optional file upload or retaining existing file on edit
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    newStory.fileName = file.name;
                    newStory.fileData = event.target.result; // Saves file as a base64 string
                    saveStory(newStory);
                };
                
                reader.readAsDataURL(file);
            } else {
                // If editing and no new file is uploaded, retain the old file data
                if (editingIndex !== null) {
                    const stories = JSON.parse(localStorage.getItem('stories') || '[]');
                    const originalStory = stories[parseInt(editingIndex)];
                    if (originalStory && originalStory.fileName) {
                        newStory.fileName = originalStory.fileName;
                        newStory.fileData = originalStory.fileData;
                    }
                }
                saveStory(newStory);
            }
        });


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            buildMenus(); 
            // Show the entire database in the background when the page loads
            renderResources(allResources);
            showSection('about'); // Default to showing the 'About' section on load
            
            // Initializing the search bar filtering (can be expanded to filter real-time)
            document.getElementById('globalSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filtered = allResources.filter(resource => 
                    (resource.title && resource.title.toLowerCase().includes(searchTerm)) ||
                    (resource.desc && resource.desc.toLowerCase().includes(searchTerm)) ||
                    (resource.language && resource.language.toLowerCase().includes(searchTerm)) ||
                    (resource.coverage && resource.coverage.toLowerCase().includes(searchTerm)) ||
                    (resource.publisher && resource.publisher.toLowerCase().includes(searchTerm))
                );
                
                // Automatically switch to the resources view when searching
                if (searchTerm.length > 0) {
                    document.getElementById('resource-title').textContent = `Search Results for "${this.value}"`;
                    showSection('resources');
                } else {
                    document.getElementById('resource-title').textContent = `Complete Resource Database`;
                }

                renderResources(filtered);
            });
        });
    </script>
</body>
</html>
