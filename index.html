<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Native American Language Archive</title>
    <style>
        /* BASE STYLES */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        /* Pure white background for the entire page */
        body { 
            /* Font is set to Helvetica family as requested */
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; 
            line-height: 1.6; 
            color: #222; 
            background: #fff; 
        }

        /* HEADER & BANNER (SIMPLE LIGHT THEME) */
        header { 
            background: #fff; 
            color: #222; 
            padding: 1.5rem 1rem 0.5rem; 
            text-align: center; 
            /* Subtle border at the bottom of the header */
            border-bottom: 1px solid #eee; 
            position: sticky; /* Sticky header */
            top: 0;
            z-index: 1000;
        }
        header h1 { font-size: 2rem; margin-bottom: 0.25rem; }
        header p { font-size: 0.9rem; font-style: normal; color: #666; }

        /* NAVIGATION (FLAT, HIGH-CONTRAST) */
        nav { 
            background: #fff; 
            /* Subtle border below the navigation */
            border-bottom: 1px solid #eee; 
            padding: 0.25rem 0;
            position: sticky; /* Make nav sticky as well */
            top: 68px; /* Position it right below the header (approx height of header) */
            z-index: 999;
        }
        nav ul { list-style: none; display: flex; flex-wrap: wrap; justify-content: center; }
        nav a { 
            display: block; 
            padding: 0.75rem 1.25rem;
            color: #222; 
            text-decoration: none; 
            font-weight: 500; 
            transition: background 0.2s; 
            cursor: pointer; /* Ensure link areas are clearly clickable */
        }
        nav a:hover { background: #f5f5f5; border-radius: 0; }
        
        /* Dropdowns */
        .dropdown { position: relative; }
        .dropdown-content { 
            display: none; 
            position: absolute; 
            background: #fff; 
            min-width: 200px; 
            border: 1px solid #ddd; 
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
            z-index: 1000; 
            max-height: 300px; /* Limit height */
            overflow-y: auto; /* Scroll if content overflows */
        }
        .dropdown:hover .dropdown-content, .dropdown-content.show { 
            display: block; 
        }

        .dropdown-content a { 
            padding: 0.75rem 1rem; 
            /* Subtle lines within the dropdown */
            border-bottom: 1px solid #eee; 
            display: block; 
        }
        .dropdown-content a:last-child { border-bottom: none; }
        .dropdown-content a:hover { background: #f0f0f0; } 
        

        /* --- SEARCH BAR (SIDE-ALIGNED) --- */
        .search-container { 
            background: #fff; 
            /* Padding adjusted for visual spacing on the right side */
            padding: 1rem 3rem 1rem 1rem; 
            border-bottom: 1px solid #ddd; 
            position: sticky; 
            top: 115px; 
            z-index: 998;
            box-shadow: none; 
            /* Push the search bar content to the right */
            display: flex;
            justify-content: flex-end; 
            width: 100%;
        }
        .search-wrapper { 
            max-width: 400px; /* Controls the width of the search box */
            width: 100%; 
            margin: 0; 
        }
        .search-bar { width: 100%; position: relative; }
        .search-bar input { 
            width: 100%; 
            padding: 0.75rem 1.5rem; 
            font-size: 1rem; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            transition: all 0.3s; 
        }
        .search-bar input:focus { outline: none; border-color: #222; }
        .search-info { 
            text-align: right; /* Aligns info text to the right */
            margin-top: 0.5rem; 
            font-size: 0.8rem; 
            color: #666; 
        }

        /* CONTENT SECTIONS */
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 2.5rem 2rem; 
        }
        section { 
            margin-bottom: 3rem; 
            padding: 0; 
            background: #fff; 
            border-bottom: 1px solid #eee;
            padding-bottom: 2rem;
        }
        .container section:last-of-type {
            border-bottom: none;
        }

        section h2 { 
            font-size: 1.8rem; 
            margin-bottom: 1rem; 
            padding-bottom: 0.5rem; 
            border-bottom: 1px solid #ddd; 
            color: #111;
        }
        .hidden { display: none; }

        /* --- STYLES FOR REGIONAL CARD DISPLAY (NEW) --- */
        .resource-list {
            margin-top: 1.5rem;
        }
        .region-group {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid #ddd;
        }
        .region-group h3 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            color: #444;
        }
        .region-scroll-container {
            max-height: 400px; /* Makes this container scrollable */
            overflow-y: auto;
            padding-right: 15px; /* Space for the scrollbar */
            padding-bottom: 5px;
        }
        .resource-card {
            background: #fcfcfc;
            border: 1px solid #eee;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .resource-card h4 {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
            color: #222;
        }
        .resource-card p {
            font-size: 0.9rem;
            margin-top: 0.5rem;
            color: #555;
        }
        .resource-details {
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: #777;
        }
        .resource-details span {
            display: inline-block;
            margin-right: 15px;
            font-weight: 500;
        }
        .resource-details a {
            color: #007bff;
            text-decoration: none;
        }
        /* --- Museum List Styles (for the separate museum section) --- */
        .museum-item {
            padding: 1rem 0;
            border-bottom: 1px dashed #ddd;
        }
        .museum-item:last-child {
            border-bottom: none;
        }
        .museum-item h3 {
            margin-bottom: 0.25rem;
            font-size: 1.2rem;
            color: #222;
        }
        .museum-item a {
            color: #007bff;
            text-decoration: none;
        }
        .museum-item a:hover {
            text-decoration: underline;
        }

        /* --- Story List (Padlet Style) --- */
        #storyList { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 1.5rem; 
            margin-top: 1.5rem; 
        }
        .story { 
            background: #fcfcfc; 
            padding: 1rem; 
            border: 1px solid #ddd; 
            border-radius: 6px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            position: relative;
            min-height: 150px;
        }
        .story h3 { font-size: 1.2rem; margin-bottom: 0.5rem; }
        .story em { display: block; font-size: 0.85rem; color: #777; margin-bottom: 0.75rem; }
        /* ... (rest of story styles) ... */

        /* FORMS & BUTTONS */
        form { margin-top: 1.5rem; display: flex; flex-direction: column; gap: 0.75rem; }
        /* ... (rest of form styles) ... */

        /* FOOTER */
        footer { 
            background: #f8f8f8; 
            color: #555; 
            text-align: center; 
            padding: 1.5rem 1rem; 
            margin-top: 3rem; 
            border-top: 1px solid #eee; 
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 768px) {
            nav ul { flex-direction: column; }
            nav a { padding: 0.75rem; }
            .search-container { 
                top: 120px; 
                justify-content: center; /* Center on small screens */
                padding: 1rem 1.5rem; 
            }
            .search-wrapper {
                max-width: 90%;
            }
            .search-info {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Native American Language Archive</h1>
        <p>Linking Past, Present and Future Voices</p>
    </header>

    <nav>
        <ul>
            <li><a onclick="showSection('about')">About</a></li>
            <li class="dropdown">
                <a onclick="toggleDropdown(this)">Digital Archive</a>
                <div class="dropdown-content" id="digital-archive-menu"></div>
            </li>
            <li class="dropdown">
                <a onclick="toggleDropdown(this)">Books</a>
                <div class="dropdown-content" id="books-menu"></div>
            </li>
            <li class="dropdown">
                <a onclick="toggleDropdown(this)">Apps</a>
                <div class="dropdown-content" id="apps-menu"></div>
            </li>
            <li class="dropdown">
                <a onclick="showSection('museums-list')">Museums</a>
                <div class="dropdown-content" id="museums-menu"></div>
            </li>
            <li><a onclick="showSection('share')">Share a Story</a></li>
            <li><a onclick="showSection('contact')">Contact</a></li>
        </ul>
    </nav>

    <div class="search-container">
        <div class="search-wrapper">
            <div class="search-bar">
                <input type="text" id="globalSearch" placeholder=" Search all resources by title, language, or region...">
            </div>
            <div class="search-info" id="searchInfo">Search across all resources</div>
        </div>
    </div>

    <div class="container">
        <section id="about">
            <h2>About Our Mission</h2>
            <p>Indigenous languages carry the **wisdom, stories and cultural heritage** of communities that have stewarded this land for thousands of years. Yet many of these irreplaceable linguistic treasures face the threat of disappearing forever. Our platform serves as a digital sanctuary where **indigenous communities, linguists and language enthusiasts** can come together to preserve oral traditions and support vital revitalization work.</p>
            <p style="margin-top: 1rem;">Here, you'll find resources for learners, documentation projects led by native speakers and tools to help communities preserve their ancestral languages. We believe every language represents a unique way of understanding the world, and preserving linguistic diversity enriches us all. Whether you're reconnecting with your heritage language, supporting revitalization efforts or exploring how people communicate across cultures, this space honors the voices that have echoed across generations and ensures they continue to thrive.</p>
        </section>

        <section id="digital-archive-section" class="hidden">
            <h2 id="digital-archive-title">Digital Archives & Websites</h2>
            <p>A collection of online language learning platforms, digital archives, and educational websites categorized by region.</p>
            <div id="digital-archive-list" class="resource-list">
                </div>
        </section>

        <section id="books-section" class="hidden">
            <h2 id="books-title">Academic Books & Language Texts</h2>
            <p>Linguistic analyses, grammars, and rare academic texts for in-depth language study.</p>
            <div id="books-list" class="resource-list">
                </div>
        </section>

        <section id="apps-section" class="hidden">
            <h2 id="apps-title">Mobile Apps & Interactive Tools</h2>
            <p>Interactive mobile applications and software designed for language learning and immersion.</p>
            <div id="apps-list" class="resource-list">
                </div>
        </section>

        <section id="museums-list" class="hidden">
            <h2>Native American Museums & Cultural Centers</h2>
            <p>These institutions offer collections, archives, and cultural programming related to Native American languages and history.</p>
            <div id="museum-list-container" class="resource-list">
                </div>
        </section>
        <section id="share" class="hidden">
            <h2>Share a Story</h2>
            <p>Contribute your own story in English or in a Native American language. 
            These stories will become part of our growing archive and are saved in your browser.</p>
            <form id="storyForm">
                <input type="text" id="storyTitle" placeholder="Story Title" required>
                <input type="text" id="storyLanguage" placeholder="Language (e.g. English, Cherokee)" required>
                <textarea id="storyContent" placeholder="Write your story here..." rows="6" required></textarea>
                <input type="file" id="storyFile" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.mp3,.mp4,.wav">
                <label for="storyFile" style="font-size: 0.9rem; color: #666;">Optional: Attach a file (PDF, Word, Text, Image, or Audio)</label>
                <button type="submit">Submit Story</button>
            </form>
            
            <h2 style="margin-top: 3rem;">Community Stories</h2>
            <div id="storyList">
                <p style="padding: 1.5rem 0; grid-column: 1 / -1; text-align: center; color: #666;">No stories added yet. Be the first!</p>
            </div>
        </section>

        <section id="contact" class="hidden">
            <h2>Contact Us</h2>
            <p>Use the form below to send a message to our team. Your message will be drafted in your local email client.</p>
            <form id="contactForm" action="mailto:lefthand.textiles@gmail.com" method="post" enctype="text/plain">
                <input type="text" name="Name" placeholder="Your Name" required>
                <input type="email" name="Email" placeholder="Your Email" required>
                <textarea name="Message" placeholder="Your Message..." rows="6" required></textarea>
                <button type="submit">Send Message</button>
            </form>
        </section>
        
    </div>

    <footer>
        <p>&copy; 2025 Native American Language Archive | Honoring Indigenous Voices</p>
    </footer>

    <script>
        // --- RESOURCE DATA (Based on PDF content) ---
        const allResources = [
            // Digital Archive (Type: Website/Digital Archive)
            { title: "Native Languages of the Americas (California Section)", type: "Website", desc: "Small non-profit organization dedicated to Native American language survival through internet technology. Provides accessible vocabulary, cultural background, and pronunciation guides for hundreds of California languages, serving as gateway to specialized materials", identifier: "https://www.native-languages.org/california.htm", coverage: "California", language: "California Languages", publisher: "Native Languages Org" },
            { title: "California State Parks - California Indians Language", type: "Website", desc: "Educational resource documenting California's 12,000-year cultural heritage and sixty-four distinct indigenous languages.", identifier: "https://www.parks.ca.gov/", coverage: "California", language: "California Languages", publisher: "CA State Parks" },
            { title: "College of the Redwoods - Local Languages Guide", type: "Digital Archive", desc: "Library guide supporting student understanding of northwestern California Indigenous languages including Tolowa, Karuk, Hupa, Yurok, Wiyot, Mattole, and Tsnungwe.", identifier: "https://redwoods.libguides.com/native-americans/iar", coverage: "California", language: "Multiple CA Languages", publisher: "College of the Redwoods" },
            { title: "Shoshoni Language Project", type: "Digital Archive", desc: "Academic language preservation initiative housing Wick R. Miller Collection archive with irreplaceable texts, images, and audio recordings", identifier: "https://shoshoniproject.utah.edu/", coverage: "Great Basin", language: "Shoshoni", publisher: "University of Utah" },
            { title: "Lingit Yoo X'atangi - The Tlingit Language", type: "Website", desc: "Comprehensive Tlingit language learning platform offering lessons, MOOC courses, dictionaries, and community resources", identifier: "https://tlingitlanguage.com/", coverage: "Northwest Coast", language: "Tlingit", publisher: "Community-based" },
            { title: "Hathi Trust Digital Library", type: "Digital Archive", desc: "California Native Collections - Millions of digitized books online including rare materials on California Native languages. Full-view volumes are freely available", identifier: "N/A", coverage: "California", language: "California Languages", publisher: "HathiTrust" },
            
            // Apps (Type: App - simulated from PDF "Website" description for "Cherokee Nation Language Platform")
            { title: "Cherokee Nation Language Platform", type: "App", desc: "Cherokee Nation's official online language learning platform offering free Cherokee language classes taught by Ed Fields. Features self-paced courses, interactive learning portal, and comprehensive resources.", identifier: "https://cnlearn.cherokee.org/", coverage: "Eastern Woodlands", language: "Cherokee", publisher: "Cherokee Nation" },
            { title: "Salish Language Kit", type: "App", desc: "Interactive mobile application for learning Salish language basics.", identifier: "AppStore/GooglePlay", coverage: "Plateau", language: "Salish", publisher: "Salish Culture Center" },
            
            // Books (Type: Academic Book)
            { title: "A Grammar of Nakoda (Assiniboine)", type: "Academic Book", desc: "This is the first complete grammatical analysis of Assiniboine language.", identifier: "N/A", coverage: "Great Plains", language: "Assiniboine (Nakoda)", publisher: "Linda A. Cumberland" },

            // Museums (Type: Museum)
            { name: "Sam Noble Museum", type: "Museum", desc: "Extensive Native American Languages Collection with 175+ languages represented through audio/video recordings, manuscripts, books, journals, and teaching curricula", identifier: "https://samnoblemuseum.ou.edu/", coverage: "Great Plains", language: "175+ Native American Languages", publisher: "University of Oklahoma" },
            { name: "Museum of Indian Arts and Culture", type: "Museum", desc: "World-renowned museum centering Indigenous perspectives and voices of Pueblo, Navajo (Diné) and Apache cultures of the Southwest.", identifier: "https://www.newmexicoculture.org/", coverage: "Southwest", language: "Pueblo, Navajo, Apache Languages", publisher: "New Mexico Dept of Cultural Affairs" },
            { name: "Heard Museum", type: "Museum", desc: "Major museum with 12 galleries of American Indian art, over 40,000 items including library and archives with 34,000+ volumes, focus on Southwest Indigenous cultures", identifier: "https://heard.org/", coverage: "Southwest", language: "Southwest Languages", publisher: "Heard Museum" },
            { name: "Indian Pueblo Cultural Center", type: "Museum", desc: "Gateway to the 19 Pueblos with museum and exhibition galleries featuring Pueblo culture, murals by Pueblo artists, and cultural programs", identifier: "https://indianpueblo.org/", coverage: "Southwest", language: "Pueblo Languages", publisher: "Indian Pueblo Cultural Center" },
        ];

        let editingIndex = null; 
        
        // --- UTILITY FUNCTIONS ---

        /** Extracts unique regions for a given resource type. */
        function getUniqueRegions(type) {
            const uniqueRegions = new Set();
            allResources.forEach(resource => {
                let matchesType = false;
                if (type === 'Digital Archive' && (resource.type === 'Website' || resource.type === 'Digital Archive')) {
                    matchesType = true;
                } else if (resource.type === type) {
                    matchesType = true;
                }
                
                if (matchesType && resource.coverage) {
                    uniqueRegions.add(resource.coverage);
                }
            });
            // Alphabetize the regions
            return Array.from(uniqueRegions).sort();
        }

        /** Renders a list of resources into regional, scrollable cards. */
        function renderRegionalCards(data, targetListId, isSearch = false) {
            const listContainer = document.getElementById(targetListId);
            if (!listContainer) return;

            listContainer.innerHTML = '';
            
            // Grouping logic
            const resourcesByRegion = data.reduce((acc, resource) => {
                const region = resource.coverage || 'Unspecified Region';
                if (!acc[region]) {
                    acc[region] = [];
                }
                acc[region].push(resource);
                return acc;
            }, {});
            
            const regions = Object.keys(resourcesByRegion);
            if (regions.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem 0;">No resources match your selection criteria.</p>';
                return;
            }

            // Sort regions alphabetically unless it's a search result (which should show all)
            const sortedRegions = isSearch ? regions : regions.sort();

            sortedRegions.forEach(region => {
                const regionGroup = document.createElement('div');
                regionGroup.className = 'region-group';
                
                regionGroup.innerHTML = `<h3>Region: ${region}</h3>`;
                
                const scrollContainer = document.createElement('div');
                scrollContainer.className = 'region-scroll-container';
                
                resourcesByRegion[region].forEach(resource => {
                    const linkText = resource.identifier === 'N/A' ? 'N/A' : 'View Resource';
                    const linkHref = resource.identifier === 'N/A' || resource.identifier === 'AppStore/GooglePlay' ? '#' : resource.identifier;
                    
                    const card = document.createElement('div');
                    card.className = 'resource-card';
                    card.innerHTML = `
                        <h4>${resource.title || resource.name} (${resource.type})</h4>
                        <p>${resource.desc}</p>
                        <div class="resource-details">
                            <span><strong>Language:</strong> ${resource.language || 'N/A'}</span>
                            <span><strong>Publisher:</strong> ${resource.publisher || 'N/A'}</span>
                            <span><strong>Link:</strong> <a href="${linkHref}" target="_blank">${linkText}</a></span>
                        </div>
                    `;
                    scrollContainer.appendChild(card);
                });
                
                regionGroup.appendChild(scrollContainer);
                listContainer.appendChild(regionGroup);
            });
        }


        /** Filters resources by type and region, then renders the dedicated card section. */
        function renderTypeSection(typeFilter, regionFilter = null) {
            let targetSectionId, targetListId, sectionTitle;

            if (typeFilter === 'Digital Archive') {
                targetSectionId = 'digital-archive-section';
                targetListId = 'digital-archive-list';
                sectionTitle = 'Digital Archives & Websites';
            } else if (typeFilter === 'Academic Book') {
                targetSectionId = 'books-section';
                targetListId = 'books-list';
                sectionTitle = 'Academic Books & Language Texts';
            } else if (typeFilter === 'App') {
                targetSectionId = 'apps-section';
                targetListId = 'apps-list';
                sectionTitle = 'Mobile Apps & Interactive Tools';
            } else {
                return; // Should not happen with current config
            }

            const filteredResources = allResources.filter(resource => {
                let matchesType = false;
                if (typeFilter === 'Digital Archive') {
                    matchesType = (resource.type === 'Website' || resource.type === 'Digital Archive');
                } else if (resource.type === typeFilter) {
                    matchesType = true;
                }
                
                const matchesRegion = (regionFilter === null || resource.coverage === regionFilter);
                
                return matchesType && matchesRegion;
            });
            
            // Update section title if a filter is applied
            const titleElement = document.getElementById(targetSectionId).querySelector('h2');
            const typeName = typeFilter.replace('Academic Book', 'Book');
            titleElement.textContent = regionFilter ? `${regionFilter} ${typeName} Resources` : sectionTitle;

            showSection(targetSectionId);
            renderRegionalCards(filteredResources, targetListId);
        }

        /** Renders the dedicated Museum list section (Uses a simple list, not regional grouping). */
        function renderMuseums(regionFilter = null) {
            const museumList = document.getElementById('museum-list-container');
            if (!museumList) return;
            
            museumList.innerHTML = '';
            
            const filteredMuseums = allResources.filter(resource => 
                resource.type === 'Museum' && (regionFilter === null || resource.coverage === regionFilter)
            );
            
            if (filteredMuseums.length === 0) {
                museumList.innerHTML = '<p style="text-align: center; color: #666;">No museums found for this region.</p>';
                return;
            }

            filteredMuseums.forEach(museum => {
                const item = document.createElement('div');
                item.className = 'museum-item';
                item.innerHTML = `
                    <h3><a href="${museum.identifier}" target="_blank">${museum.name}</a></h3>
                    <p>${museum.desc}</p>
                    <p><strong>Coverage:</strong> ${museum.coverage || 'N/A'}</p>
                `;
                museumList.appendChild(item);
            });
            
            showSection('museums-list');
        }
        
        /** Builds navigation dropdown menus based on regions and types. */
        function buildMenus() {
            const menuConfigs = [
                { id: 'digital-archive-menu', type: 'Digital Archive' },
                { id: 'books-menu', type: 'Academic Book' },
                { id: 'apps-menu', type: 'App' },
                { id: 'museums-menu', type: 'Museum' }
            ];

            menuConfigs.forEach(config => {
                const menu = document.getElementById(config.id);
                if (!menu) return;

                menu.innerHTML = ''; 
                const regions = getUniqueRegions(config.type);

                // Determine the resource name for the "View All" link
                const resourceName = config.type === 'Academic Book' ? 'Books' : config.type;
                
                // Add an option to view all resources of this type
                const allLink = document.createElement('a');
                allLink.textContent = `View All ${resourceName}`;
                
                if (config.type === 'Museum') {
                    allLink.onclick = () => renderMuseums(null);
                } else {
                    allLink.onclick = () => renderTypeSection(config.type, null);
                }
                menu.appendChild(allLink);
                
                if (regions.length > 0) {
                    const divider = document.createElement('div');
                    divider.style.borderTop = '1px solid #eee';
                    divider.style.margin = '0.5rem 0';
                    menu.appendChild(divider);
                }

                regions.forEach(region => {
                    const a = document.createElement('a');
                    a.textContent = region;
                    if (config.type === 'Museum') {
                        a.onclick = () => renderMuseums(region);
                    } else {
                        a.onclick = () => renderTypeSection(config.type, region);
                    }
                    menu.appendChild(a);
                });
            });
        }

        function showSection(sectionId) {
            // Hide all content sections (excluding the fixed search bar)
            document.querySelectorAll('.container section').forEach(section => {
                section.classList.add('hidden');
            });

            // Show the requested section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Close all dropdowns
            document.querySelectorAll('.dropdown-content').forEach(content => {
                content.classList.remove('show');
            });
        }

        function toggleDropdown(element) {
            const dropdownContent = element.nextElementSibling;
            
            // Close other open dropdowns
            document.querySelectorAll('.dropdown-content').forEach(content => {
                if (content !== dropdownContent) {
                    content.classList.remove('show');
                }
            });
            
            dropdownContent.classList.toggle('show');
        }

        // --- STORY FUNCTIONALITY (Unchanged from previous revision) ---
        function renderStories() {
            const storyList = document.getElementById('storyList');
            if (!storyList) return;
            const stories = JSON.parse(localStorage.getItem('stories') || '[]');
            storyList.innerHTML = '';
            
            if (stories.length === 0) {
                storyList.innerHTML = '<p style="padding: 1.5rem 0; grid-column: 1 / -1; text-align: center; color: #666;">No stories added yet. Be the first!</p>';
                return;
            }

            stories.forEach((story, index) => {
                const storyDiv = document.createElement('div');
                storyDiv.className = 'story';
                storyDiv.setAttribute('data-index', index);
                
                let fileAttachmentHtml = '';
                if (story.fileName && story.fileData) {
                    // Safety: fileData uses Data URL (not external link) which is safe
                    fileAttachmentHtml = `
                        <div class="file-attachment">
                            <strong>Attachment:</strong> <a href="${story.fileData}" download="${story.fileName}">${story.fileName}</a>
                        </div>
                    `;
                }
                
                storyDiv.innerHTML = `
                    <button class="delete-btn" onclick="deleteStory(${index})">Delete</button>
                    <button class="edit-btn" onclick="editStory(${index})">Edit</button>
                    <h3>${story.title}</h3>
                    <em>Language: ${story.language}</em>
                    <p>${story.content.replace(/\n/g, '<br>')}</p>
                    ${fileAttachmentHtml}
                `;
                storyList.appendChild(storyDiv);
            });
        }

        function deleteStory(index) {
            if (confirm("Are you sure you want to delete this story? This action cannot be undone.")) {
                const stories = JSON.parse(localStorage.getItem('stories') || '[]');
                stories.splice(index, 1);
                localStorage.setItem('stories', JSON.stringify(stories));
                renderStories();
            }
        }

        function editStory(index) {
            const stories = JSON.parse(localStorage.getItem('stories') || '[]');
            const story = stories[index];
            if (!story) return;

            document.getElementById('storyTitle').value = story.title;
            document.getElementById('storyLanguage').value = story.language;
            document.getElementById('storyContent').value = story.content;
            
            editingIndex = index;
            document.getElementById('storyForm').querySelector('button[type="submit"]').textContent = 'Update Story';

            document.getElementById('share').scrollIntoView({ behavior: 'smooth' });
        }


        document.getElementById('storyForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const storyTitle = document.getElementById('storyTitle').value;
            const storyLanguage = document.getElementById('storyLanguage').value;
            const storyContent = document.getElementById('storyContent').value;
            const fileInput = document.getElementById('storyFile');

            const newStory = {
                title: storyTitle,
                language: storyLanguage,
                content: storyContent,
                fileName: null,
                fileData: null 
            };
            
            const saveStory = (story) => {
                let stories = JSON.parse(localStorage.getItem('stories') || '[]');
                if (editingIndex !== null) {
                    stories[parseInt(editingIndex)] = story;
                } else {
                    stories.push(story);
                }
                
                localStorage.setItem('stories', JSON.stringify(stories));
                
                editingIndex = null; 
                document.getElementById('storyForm').querySelector('button[type="submit"]').textContent = 'Submit Story';
                this.reset();
                renderStories();
            };

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    newStory.fileName = file.name;
                    newStory.fileData = event.target.result;
                    saveStory(newStory);
                };
                
                reader.readAsDataURL(file);
            } else {
                if (editingIndex !== null) {
                    const stories = JSON.parse(localStorage.getItem('stories') || '[]');
                    const originalStory = stories[parseInt(editingIndex)];
                    if (originalStory && originalStory.fileName) {
                        newStory.fileName = originalStory.fileName;
                        newStory.fileData = originalStory.fileData;
                    }
                }
                saveStory(newStory);
            }
        });


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            buildMenus(); 
            // Render the initial content for all type sections (hidden until clicked)
            renderTypeSection('Digital Archive', null);
            renderTypeSection('Academic Book', null);
            renderTypeSection('App', null);
            renderMuseums(null); // Render museums as a list
            
            renderStories(); 
            showSection('about'); // Default to showing the 'About' section on load
            
            // Initializing the search bar filtering
            document.getElementById('globalSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                // Collect all resources except Museums for the global search
                const resourcesForSearch = allResources.filter(r => r.type !== 'Museum');

                const filtered = resourcesForSearch.filter(resource => 
                    (resource.title && resource.title.toLowerCase().includes(searchTerm)) ||
                    (resource.name && resource.name.toLowerCase().includes(searchTerm)) ||
                    (resource.desc && resource.desc.toLowerCase().includes(searchTerm)) ||
                    (resource.language && resource.language.toLowerCase().includes(searchTerm)) ||
                    (resource.coverage && resource.coverage.toLowerCase().includes(searchTerm)) ||
                    (resource.publisher && resource.publisher.toLowerCase().includes(searchTerm))
                );
                
                // Use the Digital Archive section to display global search results
                if (searchTerm.length > 0) {
                    document.getElementById('digital-archive-title').textContent = `Search Results for "${this.value}" (All Resources)`;
                    showSection('digital-archive-section');
                    // Render the combined results as regional cards (isSearch = true)
                    renderRegionalCards(filtered, 'digital-archive-list', true); 
                } else {
                    // Revert to default view when search is cleared
                    document.getElementById('digital-archive-title').textContent = `Digital Archives & Websites`;
                    showSection('about');
                    // Re-render the default Digital Archive view so it's ready when clicked next
                    renderTypeSection('Digital Archive', null);
                }
            });
        });
    </script>
</body>
</html>
