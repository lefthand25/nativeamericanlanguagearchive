<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Native American Language Database</title>
<style>
/* --- BASE STYLES --- */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; 
    line-height: 1.6; 
    color: #222; 
    background: #fafafa;
}

/* --- BLACK HEADER: Main Navigation (Sticky and Black) --- */
header { 
    background: #000; /* Explicitly Black Header */
    color: #fff; 
    padding: 2rem 1rem; 
    text-align: center; 
    border-bottom: 4px solid #444; 
    position: sticky;
    top: 0;
    z-index: 1000;
}
header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
header p { font-size: 1.1rem; font-style: italic; color: #ddd; }

/* Navigation Menu (Horizontal in the Header) */
nav { max-width: 1200px; margin: 1rem auto 0; }
nav ul { 
    list-style: none; 
    display: flex;
    justify-content: center;
    gap: 1.5rem; 
    padding: 0; 
}
nav a { 
    color: #fff; 
    text-decoration: none; 
    font-weight: 500; 
    padding: 0.5rem 0.5rem; 
    transition: color 0.3s;
    border-bottom: 2px solid transparent;
}
nav a:hover { 
    color: #ff9900;
    border-bottom: 2px solid #ff9900;
}

/* --- TWO-COLUMN LAYOUT WITH GRID --- */
.main-wrapper {
    display: grid;
    /* Sidebar width (280px) and main content (1 fraction unit) */
    grid-template-columns: 280px 1fr; 
    max-width: 1400px;
    margin: 0 auto;
    gap: 2rem;
    padding: 1.5rem 1rem;
}

/* --- LEFT SIDEBAR: Sticky Search and Filters --- */
.sidebar {
    padding: 0;
    position: sticky; /* Key: Makes the sidebar sticky */
    top: 1.5rem; /* Space from the top edge */
    height: fit-content; /* Only takes up necessary height */
}

/* Search Bar & Filters Styles (Adapted for Sidebar) */
.search-container {
    background: #fff;
    padding: 1rem;
    border: 1px solid #ddd; 
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    margin-bottom: 1rem;
}
.search-bar input { 
    width: 100%; 
    padding: 0.6rem 0.8rem; 
    font-size: 1rem; 
    border-radius: 8px; 
    border: 1px solid #ccc; 
}
.search-info { text-align: center; margin-top: 0.5rem; font-size: 0.85rem; color: #666; }

.filter-controls {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    padding: 1rem;
    background: #fff;
    border: 1px solid #ddd; 
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
.filter-controls select {
    padding: 0.5rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 100%;
}
.filter-controls label {
    font-weight: 600;
    font-size: 0.95rem;
    color: #333;
}


/* --- RIGHT CONTENT AREA Styles --- */
section { margin-bottom: 2.5rem; padding: 2rem; background: #fff; border: 1px solid #ddd; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
section h2 { font-size: 2rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #eee; }
.hidden { display: none; }
.resource-list { margin-top: 1.5rem; padding: 0; background: none; border: none; }
.resource-item { background: #fff; padding: 1.5rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }


/* --- Footer --- */
footer { background: #000; color: #fff; text-align: center; padding: 2rem 1rem; margin-top: 3rem; border-top: 4px solid #444; }

/* --- Responsive Design: Stack Columns on Small Screens --- */
@media (max-width: 900px) {
    .main-wrapper {
        grid-template-columns: 1fr; /* Stack columns */
        padding: 1rem;
    }
    .sidebar {
        position: static; /* Remove sticky on small screens */
        margin-bottom: 1rem;
        /* Make sidebar look like a standard section when stacked */
        background: #fff;
        padding: 1rem;
        border: 1px solid #ddd; 
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .filter-controls {
        background: none;
        border: none;
        box-shadow: none;
        padding: 0;
        margin-top: 1rem;
    }
}
</style>
</head>
<body>
<header>
    <h1>Native American Language Archive</h1>
    <p>Linking Past, Present and Future Voices</p>
    
    <nav>
        <ul>
            <li><a href="#about" onclick="showSection('about')">About</a></li>
            <li><a href="#resources" onclick="showAllResources()">Archive</a></li>
            <li><a href="#share" onclick="showSection('share')">Share a Story</a></li>
            <li><a href="#" onclick="alert('Contact information will go here.')">Get in Touch</a></li>
        </ul>
    </nav>
</header>

<div class="main-wrapper">

    <aside class="sidebar">
        
        <div class="search-container">
            <div class="search-wrapper">
                <div class="search-bar">
                    <input type="text" id="globalSearch" placeholder="Search resources...">
                </div>
                <div class="search-info" id="searchInfo">Search across all resources</div>
            </div>
        </div>

        <div class="filter-controls">
            <label for="categoryFilter">Filter by Category:</label>
            <select id="categoryFilter" onchange="filterResources()">
                <option value="all">All Categories</option>
                <option value="websites">Websites/Digital Archives</option>
                <option value="books">Books & Publications</option>
                <option value="apps">Apps</option>
                <option value="museums">Museums/Archives</option>
            </select>
            <label for="regionFilter">Filter by Region:</label>
            <select id="regionFilter" onchange="filterResources()">
                <option value="all">All Regions</option>
                </select>
        </div>
    </aside>

    <div class="container main-content">
        <section id="about">
            <h2>About Our Mission</h2>
            <p>Indigenous languages carry wisdom, stories and cultural heritage of communities that have stewarded this land for thousands of years. Yet many of these irreplaceable linguistic treasures face the threat of disappearing forever. Our platform serves as a digital sanctuary where indigenous communities, linguists and language enthusiasts can come together to preserve oral traditions and support vital revitalization work.</p>
            <p style="margin-top: 1rem;">Here, you'll find resources for learners, documentation projects led by native speakers, and tools to help communities preserve their ancestral languages. We believe every language represents a unique way of understanding the world, and preserving linguistic diversity enriches us all.</p>
        </section>

        <section id="resources" class="hidden">
            <h2 id="resource-title">Archive Resources</h2>
            <div id="resource-list" class="resource-list"></div>
        </section>

        <section id="share" class="hidden">
            <h2>Share a Story</h2>
            <p>Contribute your own story in English or in a Native American language. These stories will become part of our growing archive.</p>
            <form id="storyForm">
                <input type="text" id="storyTitle" placeholder="Story Title" required>
                <input type="text" id="storyLanguage" placeholder="Language (e.g. English, Cherokee)" required>
                <textarea id="storyContent" placeholder="Write your story here..." rows="6" required></textarea>
                <input type="file" id="storyFile" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.mp3,.mp4,.wav">
                <label for="storyFile" style="font-size: 0.9rem; color: #666;">Optional: Attach a file (PDF, Word, Text, Image, or Audio)</label>
                <button type="submit">Submit Story</button>
            </form>
            <div id="storyList"></div>
        </section>
    </div>
</div>

<footer>
    <p>&copy; 2025 Native American Language Database | Honoring Indigenous Voices</p>
</footer>

<script>
    // --- START: DATABASE CONTENT (Simplified for brevity, identical content as last version) ---
    const resources = {
      "websites": {
        "California": [
          { "title": "Native Languages of the Americas (California Section)", "type": "Website", "desc": "Small non-profit organization dedicated to Native American language survival through internet technology. Provides accessible vocabulary, cultural background, and pronunciation guides for hundreds of California languages, serving as gateway to specialized materials", "identifier": "https://www.native-languages.org/California.htm", "coverage": "California", "lang": "California Languages", "pub": "Native Languages Org" },
          { "title": "California State Parks - California Indians Language", "type": "Website", "desc": "Educational resource documenting California's 12,000-year cultural heritage and sixty-four distinct indigenous languages. Emphasizes the linguistic diversity crisis and current preservation efforts for languages in life-and-death struggle for survival. Provides educational resources for cultural awareness and historical understanding.", "identifier": "https://www.parks.ca.gov/?page_id=23548", "coverage": "California", "lang": "California Languages", "pub": "CA State Parks" }
        ],
        "Eastern_Woodlands": [
          { "title": "Cherokee Nation Language Platform", "type": "Website", "desc": "Cherokee Nation's official online language learning platform offering free Cherokee language classes taught by Ed Fields. Features self-paced courses, interactive learning portal, and comprehensive resources for Cherokee language students and educators seeking structured instruction.", "identifier": "https://cnlearn.cherokee.org/", "coverage": "Eastern Woodlands", "lang": "Cherokee", "pub": "Cherokee Nation" },
          { "title": "Ojibwe Language Learning Platform", "type": "Website", "desc": "Comprehensive Anishinaabemowin learning website providing beginner through advanced lessons, immersion support materials, and master-apprentice program resources. Features oral tradition integration with structured lessons for new learners without prior language knowledge requirements.", "identifier": "https://ojibwe.net/", "coverage": "Eastern Woodlands", "lang": "Ojibwe", "pub": "Community-based" }
        ],
        "Great_Basin": [
          { "title": "Pyramid Lake Paiute Tribe Language Department", "type": "Website", "desc": "Tribal language preservation program offering community-based instruction and cultural education. Provides resources for Northern Paiute language learning, cultural preservation and community engagement supporting tribal sovereignty and linguistic heritage maintenance.", "identifier": "https://plpt.nsn.us/language/", "coverage": "Great Basin", "lang": "Northern Paiute", "pub": "Pyramid Lake Paiute Tribe" }
        ],
        "Northwest_Coast": [
          { "title": "Lingít Yoo X̱ʼatángi - The Tlingit Language", "type": "Website", "desc": "Comprehensive Tlingit language learning platform offering lessons, MOOC courses, dictionaries, and community resources. Features extensive audio materials, workbooks, verb dictionaries and collaborative learning tools developed by dedicated Tlingit language teachers and speakers.", "identifier": "https://tlingitlanguage.com/", "coverage": "Northwest Coast", "lang": "Tlingit", "pub": "Community-based" },
          { "title": "Sealaska Heritage Institute Language Department", "type": "Website", "desc": "Official Southeast Alaska language revitalization hub for Lingít (Tlingit), X̱aad Kíl (Haida) and Sm'algyax (Tsimshian). Provides downloadable materials, audio dictionaries, curricula, student books and comprehensive learning resources with community oversight.", "identifier": "https://sealaskaheritage.org/shi-language-departm", "coverage": "Northwest Coast", "lang": "Tlingit, Haida, Tsimshian", "pub": "Sealaska Heritage Institute" }
        ],
        "Plateau": [
          { "title": "Yakama Nation Cultural Resources", "type": "Website", "desc": "Official tribal education program requiring two-year Sahaptin language instruction for students. Features community-based learning with elders, parents, and tribal members actively involved in teaching Ichishkíin language, reading, writing, and cultural context through comprehensive curriculum.", "identifier": "https://www.yakama.org/academics/", "coverage": "Plateau", "lang": "Sahaptin (Ichishkíin)", "pub": "Yakama Nation" }
        ],
        "Great_Plains": [
          { "title": "Fort Belknap Language Preservation Program", "type": "Website", "desc": "A tribally-run program based in Harlem, Montana, focusing on community-based preservation of Assiniboine and Gros Ventre languages.", "identifier": "https://www.ftbelknaplanguagepreservation.com/", "coverage": "Great Plains", "lang": "Assiniboine, Gros Ventre", "pub": "Fort Belknap Tribes" }
        ],
        "Southwest": [
            { "title": "Navajo Language Academy", "type": "Website", "desc": "Official resource for Diné Bizaad (Navajo) language materials, including academic resources, pedagogical guides, and community outreach information to support immersion and advanced study.", "identifier": "https://navajolanguageacademy.org/", "coverage": "Southwest", "lang": "Navajo (Diné Bizaad)", "pub": "Navajo Language Academy" }
        ],
        "Nationwide": [
          { "title": "Native Languages of the Americas", "type": "Website", "desc": "Small non-profit organization dedicated to Native American language survival through technology.", "identifier": "https://www.native-languages.org/", "coverage": "Nationwide", "lang": "Multiple Languages", "pub": "Native Languages Org" }
        ]
      },
      "books": {
        "California": [
          { "title": "Surviving Through the Days", "type": "Book", "desc": "Anthology of treasures from oral literature of Native California, assembled by editor sensitive to language, culture and history.", "identifier": "ISBN or Library Reference", "coverage": "California", "lang": "Multiple California Languages", "pub": "Various Publishers" }
        ],
        "Eastern_Woodlands": [
          { "title": "Cherokees Writing the Keetoowah Way", "type": "Book Collection", "desc": "Comprehensive translation collection providing authentic Cherokee language documentation and cultural context.", "identifier": "ISBN or Library Reference", "coverage": "Eastern Woodlands", "lang": "Cherokee", "pub": "Various Cherokee Communities" }
        ],
        "Northwest_Coast": [
          { "title": "Sealaska Heritage Institute Publications", "type": "Book Collection", "desc": "Comprehensive collection of dictionaries, workbooks, and cultural materials for Tlingit, Coast Haida, and Tsimshian languages.", "identifier": "ISBN or Library Reference", "coverage": "Northwest Coast", "lang": "Tlingit, Haida, Tsimshian", "pub": "Sealaska Heritage Institute" }
        ],
        "Great_Plains": [
          { "title": "A Concise Dictionary of Nakoda (Assiniboine)", "type": "Dictionary", "desc": "A publication created with community member Wilma Kennedy, offering a comprehensive dictionary for practical use.", "identifier": "ISBN or Library Reference", "coverage": "Great Plains", "lang": "Assiniboine (Nakoda)", "pub": "Vincent Collette" }
        ],
        "Southwest": [
          { "title": "Diné Bizaad: Speak, Read, Write Navajo", "type": "Textbook", "desc": "Comprehensive textbook providing structured approach to Navajo language learning with grammar instruction, vocabulary building, and cultural context.", "identifier": "ISBN or Library Reference", "coverage": "Southwest", "lang": "Navajo (Diné Bizaad)", "pub": "Various Publishers" }
        ],
        "Nationwide": []
      },
      "apps": {
        "California": [
          { "title": "Yapi Kapi", "type": "App", "desc": "UC Berkeley app making California Indian artifacts available online. Provides special tools for teachers and students.", "identifier": "App Store/Google Play", "coverage": "California", "lang": "Pomoan language family", "pub": "UC Berkeley" }
        ],
        "Eastern_Woodlands": [
          { "title": "Cherokee Nation Language App", "type": "App", "desc": "Official app from the Cherokee Nation for learning Cherokee (Tsalagi). Features vocabulary builders, phrase lists, and pronunciation guides.", "identifier": "App Store/Google Play", "coverage": "Eastern Woodlands", "lang": "Cherokee", "pub": "Cherokee Nation" }
        ],
        "Southwest": [
          { "title": "Navajo Language App (Various)", "type": "App", "desc": "Multiple mobile apps are available for learning Diné bizaad (Navajo), including vocabulary builders and pronunciation guides.", "identifier": "App Store/Google Play", "coverage": "Southwest", "lang": "Navajo (Diné bizaad)", "pub": "Various Developers" }
        ],
        "Nationwide": []
      },
      "museums": {
        "California": [
          { "title": "Malki Museum", "type": "Museum", "desc": "Promotes scholarship and cultural awareness while encouraging preservation of Southern California Indian Cultures.", "identifier": "Contact museum directly", "coverage": "California", "lang": "Southern CA Languages", "pub": "Malki Museum" }
        ],
        "Eastern_Woodlands": [
          { "title": "Woodland Cultural Centre", "type": "Museum", "desc": "Indigenous preservation museum dedicated to strengthening Indigenous language and culture, with a focus on Iroquoian languages and history.", "identifier": "https://woodlandculturalcentre.ca/", "coverage": "Eastern Woodlands", "lang": "Iroquoian Languages", "pub": "Woodland Cultural Centre" }
        ],
        "Northwest_Coast": [
          { "title": "Haida Gwaii Museum at Ḵay Llnagaay", "type": "Museum", "desc": "Cultural center and museum dedicated to the living culture of the Haida Nation.", "identifier": "https://www.haidagwaiimuseum.ca/", "coverage": "Northwest Coast", "lang": "Haida", "pub": "Haida Gwaii Museum" }
        ],
        "Great_Plains": [
          { "title": "Sam Noble Museum", "type": "Museum", "desc": "Extensive Native American Languages Collection with 175 languages represented through audio/video recordings, manuscripts, books, journals and teaching curricula.", "identifier": "samnoblemuseum.ou.edu/collections", "coverage": "Great Plains", "lang": "175 Native American Languages", "pub": "University of Oklahoma" }
        ],
        "Southwest": [
          { "title": "Museum of Indian Arts and Culture", "type": "Museum", "desc": "World-renowned museum centering indigenous perspectives and voices of Pueblo, Navajo (Diné), and Apache cultures of the Southwest.", "identifier": "https://www.miac.us/", "coverage": "Southwest", "lang": "Pueblo, Navajo, Apache Languages", "pub": "New Mexico Dept of Cultural Affairs" }
        ],
        "Nationwide": []
      }
    };
    // --- END: DATABASE CONTENT ---

    // --- START: JAVASCRIPT LOGIC (Updated to work with new filter location) ---
    const allSections = ["about", "resources", "share"];

    // Combine all resources into a flat array for easy searching/filtering
    let flatResources = [];
    for (const category in resources) {
        for (const region in resources[category]) {
            resources[category][region].forEach(item => {
                flatResources.push({ ...item, category: category, region: region.trim() });
            });
        }
    }

    // Get all unique regions for the filter dropdown
    function getUniqueRegions() {
        const regions = new Set();
        flatResources.forEach(item => regions.add(item.region));
        return Array.from(regions).sort((a, b) => {
            if (a.trim() === 'Nationwide') return 1;
            if (b.trim() === 'Nationwide') return -1;
            return a.localeCompare(b);
        });
    }

    function populateRegionFilter() {
        const regionFilter = document.getElementById('regionFilter');
        const regions = getUniqueRegions();
        
        regions.forEach(region => {
            const displayName = region.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
            const option = document.createElement('option');
            option.value = region;
            option.textContent = displayName;
            regionFilter.appendChild(option);
        });
    }

    function showSection(sectionId) {
      // 1. Update visibility
      allSections.forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(sectionId).classList.remove('hidden');
      
      // If we move away from resources, clear search bar and reset info
      if (sectionId !== 'resources') {
        document.getElementById('globalSearch').value = '';
        document.getElementById('searchInfo').textContent = "Search across all resources";
      }
    }

    function showAllResources() {
        showSection('resources');
        document.getElementById('categoryFilter').value = 'all';
        document.getElementById('regionFilter').value = 'all';
        document.getElementById('resource-title').textContent = 'Archive Resources';
        filterResources();
    }
    
    function renderResources(items) {
      const list = document.getElementById('resource-list');
      list.innerHTML = '';

      if (!items || items.length === 0) {
        list.innerHTML = `<p style="text-align: center; color: #555;">No resources found matching the current filters/search.</p>`;
        return;
      }

      items.forEach((item) => {
        const identifier = item.identifier ? item.identifier.trim() : 'N/A';
        const identifierLink = identifier.toLowerCase().startsWith('http') || identifier.toLowerCase().startsWith('www') ? 
            `<a href="${identifier.startsWith('http') ? identifier : 'https://' + identifier}" target="_blank">View Resource</a>` : 
            `<span style="color: #999;">Identifier/Link: ${identifier}</span>`;
        
        const displayLang = item.lang ? item.lang.replace(/\s\s+/g, ' ').trim() : 'N/A';
        const displayPub = item.pub ? item.pub.replace(/\s\s+/g, ' ').trim() : 'N/A';
        const displayDesc = item.desc ? item.desc.replace(/\s\s+/g, ' ').trim() : 'No description available.';
        const regionDisplayName = item.region.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
        const categoryDisplayName = item.category.replace(/\b\w/g, c => c.toUpperCase());


        const itemDiv = document.createElement('div');
        itemDiv.className = 'resource-item';
        itemDiv.innerHTML = `
          <h3>${item.title.trim()}</h3>
          <div class="resource-meta">
            <strong>Category:</strong> ${categoryDisplayName} |
            <strong>Region:</strong> ${regionDisplayName} |
            <strong>Type:</strong> ${item.type.trim()} | 
            <strong>Language:</strong> ${displayLang} | 
            <strong>Publisher:</strong> ${displayPub}
          </div>
          <p>${displayDesc}</p>
          ${identifierLink}
        `;
        list.appendChild(itemDiv);
      });
    }

    function filterResources() {
        showSection('resources');
        const categoryFilter = document.getElementById('categoryFilter').value;
        const regionFilter = document.getElementById('regionFilter').value;
        const query = document.getElementById('globalSearch').value.toLowerCase();
        
        let filtered = flatResources.filter(item => {
            // Filter by Category
            const categoryMatch = categoryFilter === 'all' || item.category === categoryFilter;
            
            // Filter by Region
            const regionMatch = regionFilter === 'all' || item.region === regionFilter;
            
            // Filter by Search Query
            const searchableText = `${item.title} ${item.desc} ${item.lang} ${item.pub} ${item.coverage} ${item.type} ${item.region}`.toLowerCase();
            const queryMatch = query.length < 3 || searchableText.includes(query);
            
            return categoryMatch && regionMatch && queryMatch;
        });

        // Update the title and info text
        let categoryTitle = categoryFilter === 'all' ? 'All' : document.getElementById('categoryFilter').options[document.getElementById('categoryFilter').selectedIndex].text;
        let regionTitle = regionFilter === 'all' ? '' : ` (${document.getElementById('regionFilter').options[document.getElementById('regionFilter').selectedIndex].text})`;
        
        if (query.length >= 3) {
            document.getElementById('resource-title').textContent = `Search Results for "${query}"`;
            document.getElementById('searchInfo').textContent = `Found ${filtered.length} matching resources.`;
        } else {
            document.getElementById('resource-title').textContent = `${categoryTitle} Resources${regionTitle}`;
            document.getElementById('searchInfo').textContent = `Showing ${filtered.length} resources.`;
        }
        
        // Ensure the search bar remains focused on a non-empty query, otherwise show a general message
        if (query.length < 3 && categoryFilter === 'all' && regionFilter === 'all') {
            document.getElementById('searchInfo').textContent = "Search across all resources";
        }

        renderResources(filtered);
    }

    document.getElementById('globalSearch').addEventListener('input', filterResources);
    
    // --- Share a Story Logic (Kept for completeness) ---
    let stories = JSON.parse(localStorage.getItem('stories')) || [];

    function renderStories() {
      const storyList = document.getElementById('storyList');
      storyList.innerHTML = '';

      stories.forEach((story, index) => {
        const storyDiv = document.createElement('div');
        storyDiv.className = 'story';
        
        let fileLink = '';
        if (story.fileName && story.fileData) {
            fileLink = `<div class="file-attachment">File: <a href="${story.fileData}" download="${story.fileName}">Download Attachment</a></div>`;
        }
        
        storyDiv.innerHTML = `
          <h3>${story.title}</h3>
          <em>Language: ${story.language}</em>
          <p>${story.content.substring(0, 100)}${story.content.length > 100 ? '...' : ''}</p>
          ${fileLink}
          <button class="delete-btn" onclick="deleteStory(${index})">X</button>
          <button class="edit-btn" onclick="editStory(${index})">✎</button>
        `;
        storyList.appendChild(storyDiv);
      });
    }

    function deleteStory(index) {
      if (confirm("Are you sure you want to delete this story?")) {
        stories.splice(index, 1);
        localStorage.setItem('stories', JSON.stringify(stories));
        renderStories();
      }
    }
    
    function editStory(index) {
        const story = stories[index];
        if (story) {
            document.getElementById('storyTitle').value = story.title;
            document.getElementById('storyLanguage').value = story.language;
            document.getElementById('storyContent').value = story.content;
            
            document.getElementById('storyForm').setAttribute('data-editing-index', index);
            
            document.getElementById('share').scrollIntoView({ behavior: 'smooth' });
            
            document.querySelector('#storyForm button[type="submit"]').textContent = 'Update Story';
            
            alert(`Now editing story: "${story.title}". Update the form above and click 'Update Story'.`);
        }
    }

    document.getElementById('storyForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const title = document.getElementById('storyTitle').value;
        const language = document.getElementById('storyLanguage').value;
        const content = document.getElementById('storyContent').value;
        const fileInput = document.getElementById('storyFile');
        const editingIndex = this.getAttribute('data-editing-index');
        
        let newStory = { title, language, content, timestamp: new Date().toLocaleString() };

        const saveStory = (storyData) => {
            if (editingIndex !== null) {
                // Update existing story
                stories[parseInt(editingIndex)] = { ...stories[parseInt(editingIndex)], ...storyData };
                this.removeAttribute('data-editing-index');
                document.querySelector('#storyForm button[type="submit"]').textContent = 'Submit Story';
                // Reset filter/search status
                document.getElementById('globalSearch').value = '';
                alert("Story updated successfully!");
            } else {
                // Add new story
                stories.push(storyData);
                alert("Thank you! Your story has been submitted and added to the list below.");
            }
            localStorage.setItem('stories', JSON.stringify(stories));
            this.reset();
            renderStories();
        };

        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(event) {
                newStory.fileName = file.name;
                newStory.fileData = event.target.result;
                saveStory(newStory);
            };
            
            reader.readAsDataURL(file);
        } else {
            // Preserve file data if editing and no new file uploaded
            if (editingIndex !== null && stories[parseInt(editingIndex)] && stories[parseInt(editingIndex)].fileName) {
                newStory.fileName = stories[parseInt(editingIndex)].fileName;
                newStory.fileData = stories[parseInt(editingIndex)].fileData;
            }
            saveStory(newStory);
        }
    });


    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
      populateRegionFilter();
      renderStories();
      showSection('about'); 
    });
    // --- END: JAVASCRIPT LOGIC ---
</script>
</body>
</html>
